% vim: set textwidth=78 autoindent:

\subsection{OpenStreetMap Plugin}

% when the revision of a section has been finalized, 
% comment out the following line:
% \updatedisclaimer

In den letzten Jahren hat das OpenStreetMap-Projekt an Popularität gewonnen,
weil in vielen Ländern keine freien Geodaten, wie etwa digitale Straßenkarten
zur Verfügung stehen. Ziel des OSM-Projekts ist es, eine frei editierbare
Karte der Welt auf Basis von GPS-Daten, Luftaufnahmen oder einfach nur
Ortskenntnis zu erschaffen. Um diese Idee zu unterstützen, wurde ein QGIS
Plugin geschrieben, das die Arbeit OSM-Daten ermöglicht.

Das Plugin bietet alle grundlegenden Funktionen für die
OSM-Daten-Manipulation, wie das Laden von Daten, Importieren, Speichern,
Herunterladen, Bearbeiten und Hochladen von Daten zurück auf die
OpenStreetMap-Server. Während der Erstellung des OSM Plugins fanden mehrere
Treffen mit OSM Teilnehmern statt. Ziel war es, ihre Ideen einzubeziehen, um
ein optimales Ergebnis zu erreichen.

Der folgende Abschnitt gibt eine kurze Einführung in die Prinzipien des OSM
Projektes. Wenn Sie die Informationen über OSM nicht interessieren,
überspringen Sie diesen Teil und lesen im nächsten Abschnitt weiter. Teile
der folgenden Absätze sind aus der OpenStreetMap Internetseite unter der URL
\url{http://www.openstreetmap.org} herauskopiert.

\minisec{Das OpenStreetMap Projekt}

OpenStreetMap ist ein Projekt, um eine frei editierbare Karte der Welt zu
erstellen. Die Karten werden aus GPS-Daten, Luftaufnahmen, anderen freien
Quellen oder einfach aus Ortskenntnis der Teilnehmer generiert. Das Projekt
wurde gestartet, weil die meisten Karten rechtliche oder technische
Einschränkungen für ihre Verwendung haben, die den Anwendern daran hindern,
die Daten für kreative, produktive, oder sonstige Arbeiten und Projekte
einzusetzen. Beides, die gerenderten Bilder und die Vektordaten des
OSM-Projektes stehen zum Download bereit unter der Creative Commons
Attribution ShareAlike 2.0 Lizenz.

\begin{figure}[ht]
   \begin{center}
   \caption{OpenStreetMap Daten im Internet \nixcaption}\label{fig:osmweb}\smallskip
   \includegraphics[clip=true, width=\textwidth]{osmweb}
\end{center}
\end{figure}

OpenStreetMap wurde von Seiten wie Wikipedia inspiriert - die Karte
(siehe Abbildung \ref{fig: osmweb}) verfügt über einen deutlich
hervorgehobenen \tab{Bearbeiten} Reiter sowie eine vollständige Historie der
durchgeführten Änderungen. Registrierte Nutzer können GPS-Track Protokolle
hochladen und die Vektordaten unter Verwendung der bereitgestellten
Bearbeitungswerkzeuge editieren.

OSM-Daten Primitiv ist eine Objektklasse, die über die API auf dem Server
gespeichert werden kann. Die drei unterstützten Datentypen sind:
\textbf{Knoten}, \textbf{Weg} und \textbf{Verknüpfung}.

\begin{itemize}
\item \textbf{Ein Knoten} ist ein Latitude/Longitude Koordinatenpaar. Es wird
als Grundlage für andere Objekte oder selbst als Objekt (Point of Interest),
wenn es entsprechend gekennzeichnet ist. 
\item \textbf{Ein Weg} ist eine Liste von mindestens zwei Knoten, die ein
lineares Objekt beschreiben, z.B. eine Straße. Knoten können Teil von
multiplen Wegen sein.
\item \textbf{Eine Verknüpfung} ist eine Gruppe von null oder mehreren
Primitivs und damit zusammenhängenden Rollen. Es wird verwendet, um
Beziehungen zwischen Objekten festzulegen und kann darüberhinaus auch ein
abstraktes Objekt darstellen.
\end{itemize}

Eine Vielzahl logischer Objekte können in einer gemeinsamen Karte definiert
werden (z.B. 'Point Of Interest', 'Straße', 'Straßenbahnlinie',
'Bushaltestelle" etc.). Diese Kartenobjekte sind allesamt gut in der
OSM-Community bekannt und werden als sogenannte 'Tags' gespeichert, auf
Grundlage eines Schlüssels und einem Wert. OSM ist in der Regel im
XML-Format abgelegt. XML Payload wird auch für die Kommunikation mit den
OSM-Server verwendet.

\minisec{QGIS - OSM Verbindung}\label{qgis-osm-connection}

Der erste Teil dieses Abschnitts beschreibt, wie OSM Daten-Primitivs in QGIS
Vektorlayern angezeigt werden. Wie oben beschrieben, bestehen OSM Daten aus
Knoten, Wegen und Verknüpfungen. In QGIS werden sie als drei verschiedene
Layertypen angezeigt: Punktlayer, Linienlayer und Polygonlayer. Es ist nicht
möglich diese Layertypen zu entfernen und stattdessen mit den anderen zu
arbeiten.

\begin{itemize}
\item Ein \textbf{Punktlayer} zeigt alle Objekte des Typs Knoten, die
eigenständig sind. Also nur die Knoten, die nicht Teil von Wegen sind, werden
als Punktlayer dargestellt.
\item Ein \textbf{Linienlayer} zeigt die OSM Objekte des Typs Weg, die nicht
geschlossen sind. D.h. kein Weg beginnt und endet mit demselben
Koordinatenpaar (Knoten).
\item Ein \textbf{Polygonlayer} zeigt alle Wege, die nicht im Linienlayer
gespeichert sind.
\end{itemize}

OpenStreetMap Daten haben neben den bereits angesprochenen Primitivs noch ein
weiteres: \textbf{Verknüpfungen}. Es gibt absichtlich keinen Vektorlayer, um
Beziehungen darzustellen. Eine Verknüpfungen definiert Beziehungen zwischen
einer beliebigen Anzahl von Daten Primitivs. Nachdem ein Punkt, eine Linie
oder ein Polygon auf der Karte identifiziert wurde, zeigt das OSM Plugin eine
Liste aller Verknüpfungen des identifizierten Objekts an.

Anspruchsvoll war das Design der Verbindung zwischen den OSM-Daten und den
Standard QGIS Bearbeitungswerkzeugen. Diese Instrumente arbeiten jeweils mit
einem einzigen Vektorlayer zur Zeit, egal, welche Objektart angezeigt wird.
Dies bedeutet, dass, wenn OSM Daten in QGIS mit dem Plugin geladen werden,
theoretisch einzelne Punkt-, Linien- oder Polygonlayer mit diesen
Standard-Tools getrennt bearbeitet werden können.

Das Problem ist, dass Linenlayer aus zwei verschiedenen Arten von OSM
Objekten bestehen - Wege und Knoten. Warum? Weil im OSM-Format ein Weg aus
Knoten besteht. Wenn Sie beginnen, einen Linienlayer zu verändern, haben die
Veränderungen nicht nur Auswirkung auf die OSM-Wege, sondern auch die
OSM-Knoten, die dazu gehören.

Die QGIS Standard-Editierwerkzeuge können dem OSM-Provider nicht mitteilen,
welche Bestandteile welcher Linie geändert wurden und wie. Es wird nur
mitgeteilt, was die neue Geometrie die Linie ist, und das ist nicht genug, um
Änderungen korrekt an die OSM-Datenbank zu übertragen. Der Linienlayer kennt
auch nicht die Bezeichnung der Linienmitglieder. Das gleiche Problem tritt
auf, wenn Sie versuchen, Polygonlayer zu bearbeiten.

Aus diesem Grund muss das OSM-Plugin seine eigenen Werkzeuge für die
Bearbeitung von OSM-Daten bereitstellen, damit diese korrekt editiert werden
können. Das Plugin besteht aus Werkzeugen für das Erstellen, Löschen und
Verscheiben von Punkten, Linien, Polygonen und Verknüpfungen.

\textbf{Note:} Um eine Verbindung zwischen den Editierwerkzeugen von QGIS und
dem OSM-Plugin zu ermöglichen, wären umfangreiche Änderungen im QGIS Kern
notwendig.

\subsubsection{Installation}

Das OpenStreetMap Plugin ist ein Kern-Plugin in QGIS. Wenn Ihre QGIS Python
unterstützt, dann kann das OpenStreetMap Plugin über den Plugin Manager
geladen werden, wie in Kapitel \ref{sec:load_core_plugin} beschrieben. 

\subsubsection{Die Benutzeroberfläche des OSM Plugins}

Beim ersten Start des OSM Plugins, und nachdem die ersten Daten geladen
wurden, erscheinen eine Reihe von Icons im QGIS Werkzeugmenü, zusammen mit
neuen grafischen Elementen, wie in Abbildung \ref{fig:osmwidget} zu sehen.

\begin{figure}[ht]
   \begin{center}
   \caption{Benutzeroberfläche des OSM Plugins \nixcaption}\label{fig:osmwidget}\smallskip
   \includegraphics[clip=true, width=\textwidth]{osm_widgets}
\end{center}
\end{figure}

\minisec{OSM Objekt Dialog}

The OSM Feature widget helps to identify OSM features. It
shows basic information on feature type and identifier as well as info on
who has when changed a feature. The OSM Feature widget also provides all 
editing tools (in the top part of it). More information on those tools can be
found in the sections below. The widget is initially disabled. It
activates itself after successfull loading some OSM data.

\minisec{OSM Undo/Redo widget}

This Undo/Redo widget is used to undo and redo edit actions. It consists 
not only of a classical Undo and Redo button, it also shows a list with a 
brief description of the edit actions that were done. The OSM Undo/Redo 
widget is initially closed. You can show it using a button on OSM Feature
widget.

\minisec{Toolbar menu icons}

\begin{description}
\item \toolbtntwo{osm_load}{Load OSM from file}: is used to load data from a 
special OpenStreetMap XML file.
\item \toolbtntwo{osm_featureManager}{Show/Hide OSM Feature Manager} is 
used to show or hide the OSM Feature widget. The OSM Feature widget is a 
panel that helps with OSM feature identification and with OSM data editing.
\item \toolbtntwo{osm_download}{Download OSM data} is used to download data 
from the OpenStreetMap server.
\item \toolbtntwo{osm_upload}{Upload OSM data} is used to upload changes 
(on current data). 
\item \toolbtntwo{osm_import}{Import data from a layer} is used to import 
data from a vector layer. At least one vector layer must be loaded and 
current OSM data must be selected.
\item \toolbtntwo{osm_save}{Save OSM to file} is used to save OSM data 
back to an XML file.
\end{description}

More detailed information on all the widgets, buttons and dialogs can be
found in appropriate sections of this plugin section according to their 
functionality (editing, identification, etc.).

\subsubsection{Loading OSM data}

The first action that should be done after starting the OSM Plugin is 
opening data from an OSM file. OSM data can be import as shapefile or 
downloaded directly from the OpenStreetMap server. Here we are focusing 
on the first mentioned method.

To load data from a file use the \toolbtntwo{osm_load}{Load OSM from file} 
icon. If there is no such button, maybe someone disabled OpenStreetMap 
toolbar in your QGIS instalation. You can enable it again selecting
\mainmenuopt{Settings} > \mainmenuopt{Toolbars} > \dropmenuopt{OpenStreetMap}.

\begin{figure}[ht]
   \begin{center}
   \caption{Load OSM data dialog \nixcaption}\label{fig:osmload}\smallskip
   \includegraphics[clip=true, width=12cm]{osmloaddialog}
\end{center}
\end{figure}

Purpose of its elements is explained below.

\begin{description}
\item \textbf{OpenStreetMap file to load}: Click on the button to select 
the .osm file you want to load data from.
\item \textbf{Add columns for tags}: This option determines a connection 
between OSM and QGIS data. Each feature of OSM data has 
some tags (pairs of key and value), that define the feature properties. 
Each feature of a QGIS vector layer also has its attributes (key and value). 
With this option you can define which properties of OSM objects should 
be visible when displaying detailed information about QGIS features.
\item \textbf{Replace current data}: Checking this option means that 
new data should replace current data the user is working with. Layers of 
current data will be removed and new ones will be loaded. When loading 
OSM data for the first time, this option is not active, because there is 
nothing to replace.
\item \textbf{Use custom renderer}: This option determines how many details 
of the map will be used. There are three pre-defined OSM styles for map 
displaying. Use \button{Small scale} if you want to view OSM data at low level, 
to see all details and to edit something. If not you can use 
\button{Medium scale} or \button{Large scale}. QGIS \CURRENT doesn't 
support changing the renderer style dynamically.
\end{description}

Click \button{Ok} to load your data. If this is the first time OSM 
file is loaded, the plugin must first parse the database. This may take few 
seconds or minutes - it depends on the amount of loaded data.

\subsubsection{Viewing OSM data}

After OSM data are loaded, you can identify map features using the
appropriate tool. Use the \toolbtntwo{osm_identify}{Identify feature} 
button on the top-left of OSM Feature widget. Using this tool you can 
easily explore all map objects. When the mouse cursor is placed over an 
object, you can see all information on it directly in the OSM Feature widget. 
There is also a dynamic rubberband displayed on the map so that the user 
is able to determine which feature is currently identified.

The \tab{Properties} tab of the widget contains of all feature tags. 
Clicking on the \tab{Relation} tab shows you a list of all relations 
connected with identified feature.

If you want to hold a feature for a while to be able to read its properties 
and relations, move the mouse cursor at the same time, try left-clicking 
while you are over the feature. Identification process will stop until next 
left-clicking.

Sometimes there are more than one feature at a point where left-clicking
was performed. This happens especially when clicking on cross-roads or if 
you didn't zoom enough into the map. In this situation only one of such 
features is identified (and marked with the rubberband) but the plugin 
remembers all of them. Then (still in the pause mode) you can change 
identified features cyclical with right-clicking.

\subsubsection{Editing basic OSM data}

In the title of this section 'basic data' means non-relation OSM features -
nodes and ways. If you prefer reading information on relation editing, just
skip this section and read the next one.
 
Basic data editing is a key part of OSM Plugin. You can change property,
position or shape of any existing basic feature. You can remove features or
add new ones. All such changes on nodes and ways are remembered for 
comfortable usage of Undo/Redo operations and for easy upload of all changes
to OpenStreetMap server.

\minisec{Changing feature tags}

Changing the property/tag of an OSM feature can be done directly in 
the table of feature tags. The Tags table of basic features can be found 
on the OSM Feature widget. Don't forget to identify feature first.

\begin{figure}[ht]
   \begin{center}
   \caption{Changing an OSM feature tag \nixcaption}\label{fig:osmchfeattag}\smallskip
   \includegraphics[clip=true, width=12cm]{osm_changefeaturetag}
\end{center}
\end{figure}

If you want to change a tag value, just double-click in the appropriate row of
column 'Value' and type or select a new value. If you want to remove a tag, 
click in its row, then use button \button{Remove selected tags} on the right 
bottom under the table.

To add new tags just type its key and value into the last row of the table -
where '<next tag value>' is written. Notice that you cannot change the key of 
an existing tag pair. For comfortable usage, there are some combo boxes of all
existing tag keys and their typical values.

\minisec{Point creation,}

For point creation there is a \toolbtntwo{osm_createPoint}{Create point} 
button on the OSM Feature widget. To create some points just click on the 
button and start clicking on the map. If your cursor is over some map 
feature, the feature is marked/identified immediately. If you click on 
the map when a line or polygon is marked, a new point is created directly on 
such line or polygon - as its new member. If your cursor is over an existing 
point, new point cannot be created. In such case the OSM plugin will show
following message:

\begin{figure}[ht]
   \begin{center}
   \caption{OSM point creation message \nixcaption}\label{fig:osmpoicreat}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_pointcreation}
\end{center}
\end{figure}

The mechanism of helping a user to hit the line or polygon is called snapping
and is enabled by default. If you want to create a point very close to some
line (but not on it) you must disable snapping by holding the
\keystroke{Ctrl} key first.

\minisec{Line creation}

For line creation there is a \toolbtntwo{osm_createLine}{Create line} button 
on the OSM Feature widget. To create a line just click the button and start 
left-clicking on the map. Each of your left-clicks is remembered as a member 
vertex of the new line. Line creation ends when first right-click is performed. 
The new line will immediately appear on the map.

\textbf{Note}: A Line with less than two members cannot be created. In 
such case the operation is ignored.

Snapping is performed to all map vertices - points from Point vector layer
and all Line and Polygon members. Snapping can be disabled by holding the 
\keystroke{Ctrl} key.

\minisec{Polygon creation}

For polygon creation there is a \toolbtntwo{osm_createPolygon}{Create polygon} 
button on the OSM Feature widget. To create a polygon just click the button 
and start left-clicking on the map. Each of your left-clicks is remembered as 
a member vertex of the new polygon. The Polygon creation ends when first 
right-click is performed. The new polygon will immediately appear on the map.
Polygon with less than three members cannot be created. In such case
operation is ignored. Snapping is performed to all map vertexes - points 
(from Point vector layer) and all Line and Polygon members. Snapping can be 
disabled by holding the \keystroke{Ctrl} key.

\minisec{Map feature moving}

If you want to move a feature (no matter what type) please use the
\toolbtntwo{osm_move}{Move feature} button from the OSM Feature widget menu. 
Then you can browse the map (features are identified dynamically when you 
go over them) and click on the feature you want to move. If a wrong feature is
selected after your click, don't move it from the place. Repeat right-clicking
until the correct feature is identified. When selection is done and you move
the cursor, you are no more able to change your decision what to move.
To confirm the move, click on the left mouse button. To cancel a move, click 
another mouse button.

If you are moving a feature that is connected to another features, these
connections won't be damaged. Other features will just adapt themselves to
a new position of a moved feature. 

Snapping is also supported in this operation, this means: 

\begin{itemize}
\item When moving a standalone (not part of any line/polygon) point, 
snapping to all map segments and vertices is performed.
\item When moving a point that is a member of some lines/polygons, 
snapping to all map segments and vertices is performed, except for 
vertices of point parents.
\item When moving a line/polygon, snapping to all map vertices is performed. 
Note that the OSM Plugin tries to snap only to the 3 closest-to-cursor 
vertices of a moved line/polygon, otherwise the operation would by very slow.
Snapping can be disabled by holding \keystroke{Ctrl} key during the operation.
\end{itemize}

\minisec{Map feature removing}

If you want to remove a feature, you must identify it first. To remove 
an identified feature, use the \toolbtntwo{osm_removeFeat}{Remove this 
feature} button on the OSM Feature widget. When removing a line/polygon, 
the line/polygon itself is deleted, so are all its member points that 
doesn't belong to any other line/polygon. 

When removing a point that is member of some lines/polygons, the point is 
deleted and the geometries of parent lines/polygons are changed. The new 
parent geometry has less vertices than the old one.

If the parent feature was a polygon with three vertexes, its new geometry 
has only two vertexes. And because there cannot exist polygon with only two 
vertices, as described above, the feature type is automatically changed to 
Line.

If the parent feature was a line with two vertexes, its new geometry has 
only one vertex. And because there cannot exist a line with only one vertex, 
the feature type is automatically changed to Point.

\subsubsection{Editing relations}\label{editing_osm_relation}

Thanks to existency of OSM relations we can join OSM features into groups and
give them common properties - in such way we can model any possible map
object: borders of a region (as group of ways and points), roads of a bus,
etc. Each member of a relation has its specific role. There is a pretty good 
support for OSM Relations in our plugin. Let's see how to examine, create, 
update or remove them.

\minisec{Examining relation}\label{examrelation}

If you want to see relation properties, first identify one of its members.
After that open the \tab{Relations} tab on the OSM Feature widget. At the 
top of the tab you can see a list of all relations the identified feature 
is part of. Please choose the one you want to examine and look at its 
information below. In the first table called 'Relation tags' you find the 
properties of the selected relation. In the table called 'Relation members' 
you see brief information on the relation members. If you click on a member, 
the plugin will make a rubberband on it in the map.

\minisec{Relation creation}

There are 2 ways to create a relation: 

\begin{enumerate}
\item You can use the \toolbtntwo{osm_createRelation}{Create relation} 
button on OSM Feature widget.
\item You can create it from the \tab{Relation} tab of OSM Feature widget 
using the \toolbtntwo{osm_addRelation}{Add relation} button.   
\end{enumerate}

In both cases a dialog will appear. For the second case, the feature that 
is currently identified is automatically considered to be the first 
relation member, so the dialog is prefilled a little. When creating 
a relation, please select its type first. You can select one of 
predefined relation types or write your own type. After that fill the 
relation tags and choose its members.

If you have already selected a relation type, try using the 
\toolbtntwo{osm_generateTags}{Generate tags} button. It will generate typical 
tags to your relation type. Then you are expected to enter values to the 
keys. Choosing relation members can be done either by writing member 
identifiers, types and roles or using the \toolbtntwo{osm_identify}{identify} 
tool and clicking on map.

Finally when type, tags and members are chosen, the dialog can be submitted.
In such case the plugin creates a new relation for you.

\minisec{Changing relation}

If you want to change an existing relation, identify it first (follow steps
written above in Section 'Examining relation'). After that click on the 
\toolbtntwo{osm_editRelation}{Edit relation} button. You will find it 
on the OSM Feature widget. A new dialog appears, nearly the same as for the 
'create relation' action. The dialog is pre-filled with information on 
given relations. You can change relation tags, members or even its type. 
After submiting the dialog your changes will be commited.

\subsubsection{Downloading OSM data}  

To download data from OpenStreetMap server click on the 
\toolbtntwo{osm_download}{Download OSM data} button. If there is no 
such button, the OSM toolbar may be disabled in your QGIS instalation.
You can enable it again at \mainmenuopt{Settings} > 
\mainmenuopt{Toolbars} > \dropmenuopt{OpenStreetMap}. After clicking the 
button a dialog occurs and provides following functionalities:

\begin{figure}[ht]
   \begin{center}
   \caption{OSM download dialog \nixcaption}\label{fig:osmdownload}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_downloaddialog}
\end{center}
\end{figure}

\begin{description}
\item \textbf{Extent}: Specifies an area to download data from intervals 
of latitude and longitude degrees. Because there is some restriction of 
OpenStreetMap server on how much data can be downloaded, the intervals 
must not be too wide. More detailed info on extent specification can is 
shown after clicking the \toolbtntwo{osm_questionMark}{help} button on 
the right.
\item \textbf{Download to}: Here you are expected to write a path to the 
file where data will be stored. If you can't remember the structure of 
your disk, don't panic. The \button{browse} button will help you.
\item \textbf{Open data automatically after download}: Determines, if the 
download process should be followed by loading the data process or not. If you 
prefer not to load data now, you can do it later by using 
the \toolbtntwo{osm_load}{Load OSM from file} button.
\item \textbf{Replace current data}: This option is active only if 
\radiobuttonon{Open data automatically after download} is checked. 
Checking this option means that downloaded data should replace
current data we are working with now. Layers of the current data will be 
removed and new ones will be loaded. When starting QGIS and downloading 
OSM data for the first time, this option is initially inactive, because 
there is nothing to replace.
\item \textbf{Use custom renderer}: This option is active only if the 
\radiobuttonon{Open data automatically after download} checkbox is checked. 
It determines how many details will be in the map. There are three predefined 
OSM styles for map displaying. Use \button{Small scale} if you want to view 
OSM data at low level, to see all details and to edit something. If not you 
can use \button{Medium scale} or \button{Large scale}. QGIS \CURRENT does 
not support changing the renderer style dynamically.
\end{description}

Click the \button{Download} button to start the download process.

A progress dialog will continuously inform you about how much of data is
already downloaded. When an error occures during the download process, a 
dialog tells you why. When action finishes succesfully both the progress dialog
and download dialog will close themselves.

\subsubsection{Uploading OSM data}  

Note that the upload is always done on current OSM data. Before opening the 
OSM Upload dialog, please be sure that you really have the right active 
layer ~ OSM data.

To upload current data to the OSM server click on the 
\toolbtntwo{osm_upload}{Upload OSM data} button. If there is no such button, 
OSM toolbar in your QGIS installation is disabled. You can enable it 
again in \mainmenuopt{Settings} > \mainmenuopt{Toolbars} > 
\dropmenuopt{OpenStreetMap}. After clicking the \button{upload} button a 
new dialog will appear.

\begin{figure}[ht]
   \begin{center}
   \caption{OSM upload dialog \nixcaption}\label{fig:osmupload}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_uploaddialog}
\end{center}
\end{figure}

At the top of the dialog you can check, if you are uploading the correct data. 
There is a short name of a current database. In the table you find information 
on how many changes will be uploaded. Statistics are displayed separately 
for each feature type.

In the 'Comment on your changes' box you can write brief information on 
meaning of your upload operation. Just write in brief what data changes 
you've done or let the box empty.
Fill 'OSM account' arrays so that the server could authenticate you. If 
you don't have an account on the OSM server, it's the best time to create 
one at \url{http://www.openstreetmap.org}. Finally use \button{Upload} to 
start an upload operation.

\subsubsection{Saving OSM data}  

To save data from a current map extent to an XML file click on the
\toolbtntwo{osm_save}{Save OSM to file} button. If there is no such button, 
the OSM toolbar in your QuantumGIS installation is probably disabled. You can 
enable it again in \mainmenuopt{Settings} > \mainmenuopt{Toolbars} >
\dropmenuopt{OpenStreetMap}. After clicking on the button a new dialog appears.

\begin{figure}[ht]
   \begin{center}
   \caption{OSM saving dialog \nixcaption}\label{fig:osmsave}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_savedialog}
\end{center}
\end{figure}

Select features you want to save into XML file and the file itself. Use 
the \button{Ok} button to start the operation. The process will create an 
XML file, in which OSM data from your current map extent are represented. 
The OSM version of the output file is 0.6. Elements of OSM data 
(<node>, <way>, <relation>) do not contain information on their changesets 
and uids. These informations are not compulsory yet, see DTD for
OSM XML version 0.6. In the output file OSM elements are not ordered.

Notice that not only data from the current extent are saved. Into the output 
file the whole polygons and lines are saved even if only a small part of them 
is visible in the current extent. For each saved line/polygon all its member 
nodes are saved too.

\subsubsection{Import OSM data}  

To import OSM data from an opened non-OSM vector layer follow this 
instructions: Choose current OSM data by clicking on one of their layers. 
Click on the \toolbtntwo{osm_import}{Import data from a layer} button. If 
there is no such button, someone has probably disable the OpenStreetMap 
toolbar in your QGIS installation. You can enable it again in 
\mainmenuopt{Settings} > \mainmenuopt{Toolbars} > \dropmenuopt{OpenStreetMap}. 

After clicking on the button following message may show up:

\begin{figure}[ht]
   \begin{center}
   \caption{OSM import message dialog \nixcaption}\label{fig:osmimportmessage}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_importdialog}
\end{center}
\end{figure}

In such case there is no vector layer currently loaded. The import must be d
one from a loaded layer - please load a vector layer from which you want to 
import data. After a layer is opened, your second try should give you a 
better result (don't forget to mark the current OSM layer again):

\begin{figure}[ht]
   \begin{center}
   \caption{Import data to OSM dialog \nixcaption}\label{fig:osmimporttoosm}\smallskip
   \includegraphics[clip=true, width=8cm]{osm_importtoosmdialog}
\end{center}
\end{figure}

Use the submit dialog to start the process of OSM data importing.
Reject it if you are not sure you want to import something.

