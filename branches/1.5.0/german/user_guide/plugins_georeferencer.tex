% vim: set textwidth=78 autoindent:

\section{Georeferenzier Plugin}\index{Plugins!Georeferenzierer}

% when the revision of a chapter has been finalized, 
% comment out the following line:
%\updatedisclaimer

Das Plugin \toolbtntwo{georeferencer}{Georeferenzierer} erlaubt die
Erstellung von Worldfiles für Rasterkarten. Es ermöglicht damit das
georeferenzieren von Rasterdaten in geographische und projizierte
Koordinatensysteme durch das Erstellen eines World files oder die
Transformation des Rasters in ein neues Koordinatensystem. Der Ansatz besteht
darin, Bezugspunkte auf der Rasterkarte zu finden, denen eindeutige
Koordinaten zugewiesen werden können. Die Quelle der Bezugspunkten kann dabei
sein:

\begin{enumerate}
\item Der Rasterlayer selbst, für den Fall das Koordinaten auf den
Kartenrändern oder in der Karte selbst vermerkt sind. In diesem Fall können
Sie die Koordinaten der Bezugspunkte manuell eintragen.
\item Ein anderer georeferenzierter Raster- oder Vektorlayer, der die
gleichen Objekte zeigt, wie auf des zu referenzierenden Rasterlayers. In
diesem Fall können Sie die Koordinaten der Bezugspunkte festlegen, indem Sie
den bereits georeferenzierten Layer in QGIS laden und dann mit der Maus
Bezugspunkte auf beiden Layern anklicken.
\end{enumerate}

Das normale Vorgehen beim georeferenzieren eines Rasterlayers beinhaltet das
Auswählen von mindestens vier Bezugspunkten auf dem Rasterlayer, das Zuweisen
von Koordinaten und die Auswahl des passenden Transformationstyps. Basierend
auf den Eingabeparametern und den Daten, wird dann ein Worldfile erstellt.
Dabei gilt allgemein: Je mehr, räumlich gleichmäßig verteilte Bezugspunkte
gesetzt wurden, umso besser wird das Resultat ausfallen. 

Als ersten Schritt starten Sie QGIS, laden das Georeferenzier Plugin
(siehe Kapitel~\ref{sec:load_core_plugin}) und klicken dann auf das Icon
\toolbtntwo{georeferencer}{Georeferenzierer} in der Werkzeugleiste. Daraufhin
erscheint der Dialog, wie in Abbildung~\ref{fig:georefplugin} zu sehen.

In diesem Beispiel soll ein Worldfile für eine topografische Karte aus der
Gegend Süd-Dakotas erstellt werden, welche zu dem GRASS Spearfish-Datensatz
passt. Diese Karte kann später zusammen mit den erstellten Daten in
der GRASS spearfish60 Location dargestellt werden. Die topopgrafische Karte
steht unter folgender Adresse zum Download bereit.
\url{http://grass.osgeo.org/sampledata/spearfish\_toposheet.tar.gz}

\begin{figure}[ht]
\begin{center}
  \caption{Das Georeferenzier Plugin \nixcaption}\label{fig:georefplugin}\smallskip
  \includegraphics[clip=true,width=0.9\textwidth]{georefplugin}
\end{center}
\end{figure}

Nach dem Laden der topopgrafischen Karte, wird diese im Fenster des
Georeferenzierer geöffnet, wie in Abbildung~\ref{fig:georefplugin} zu sehen.

\minisec{Eingabe von Bezugspunkten (Ground Control Points (GCP))}\label{georeferencer_entering}

Mit dem Knopf \toolbtntwo{mActionCapturePoint}{Addiere Punkt} können Sie nun
damit beginnen dem Rasterbild Bezugspunkte und die dazugehörigen Koordinaten
hinzuzufügen (siehe Abbildung~\ref{fig:choose_points}). Aus diesen
Punktkoordinaten errechnet das
Plugin später die entsprechenden Worldfile Parameter. Je mehr Bezugspunkte
Sie erstellen, desto genauer wird in der Regel das Ergebnis. Für die Angabe
der nötigen Punktkoordinaten stehen Ihnen zwei unterschiedliche
Vorgehensweisen zur Verfügung.

\begin{enumerate}
\item Sie klicken auf einen Punkt in der Rasterkarte und geben die X- und
Y-Koordinaten ein.
\item Sie klicken auf einen Punkt in der Rasterkarte und wählen den Knopf
\button{aus Karte}, um die X- und Y-Koordinaten mit Hilfe einer
georeferenzierten, in QGIS geladenen Karte hinzuzufügen.
\end{enumerate}

\begin{figure}[ht]
\begin{center}
  \caption{Bezugspunkte zu einem Rasterbild hinzufügen \nixcaption}\label{fig:choose_points}\smallskip
  \includegraphics[clip=true,width=0.6\textwidth]{choose_points}
\end{center}
\end{figure}

In unserem Beispiel nutzen wir die zweite Option und geben die Koordinaten
der ausgewählten Punkte mit Hilfe des Vektorlayers \filename{roads} aus der
\usertext{spearfish60} Location ein. Diese Daten stehen unter folgender
Adresse zum Download bereit: \\
\url{http://grass.osgeo.org/sampledata/spearfish\_grass60data-0.3.tar.gz}

Für den Fall, dass Sie nicht wissen, wie Sie die spearfish60 Location in QGIS
integrieren und mit Hilfe des GRASS Plugins verwenden können, finden Sie im
Abschnitt~\ref{sec:grass} weitere Informationen. 

Wie Sie in Abbildung~\ref{fig:choose_points} sehen können, stellt Ihnen der
Georeferenzierdialog auch Icons zum Vergrößern/Verkleinern, zum Verschieben,
sowie zum Hinzufügen und Löschen von Bezugspunkten zur Verfügung. 

Die gesetzten Bezugspunkte werden zusammen mit dem Rasterbild als Textdatei
mit der Endung \filename{.points} gespeichert. Dies erlaubt uns, bei Bedarf
das Georeferenzier Plugin wieder zu öffnen und neue Punkte
hinzuzufügen oder bestehende Punkte zu löschen, um dadurch das Ergebnis zu
verbessern. 

\minisec{Auswahl des Transformationstyps}\label{georeferencer_transformation}

Nachdem Sie in dem Bild eine ausreichende Anzahl an Punkten gesetzt haben,
gilt es nun, für die Georeferenzierung die gewünschte
Koordinaten-Transformationsmethode auszuwählen und die daraus errechneten
Worldfile Daten zusammen mit dem Tiff zu speichern. In der aktuellen QGIS
Version stehen folgende Algorithmen zur Auswahl:

\begin{itemize}[label=--]
\item \textbf{Linear}: Der lineare (affine) Algorithmus wird verwendet, um
einen Worldfile zu
erstellen. Er unterscheidet sich von den anderen Algorithmen, da tatsächlich
keine Transformation stattfindet. Für verzerrte Daten, z.B. gescannte Karten
werden die Ergebnisse wahrscheinlich nicht ausreichen.
\item \textbf{Helmert}: Die Helmert Transformation führt eine einfache
Skalierung und Rotation der Daten durch.
\item \textbf{Polynomial 1, 2 und 3}: Die Polynomial Algorithmen stellen die
am häufigsten verwendeten
Algorithmen zur Georeferenzierung dar. Sie unterscheiden sich anhand des
Entzerrungsgrades, der verwendet wird, damit die Bezugspunkte der zu
georeferenzierenden Karte mit den Bezugspunkten der Zielkarte genau
zueinander passen. Am häufigsten wird der Polynomial 2 Algorithmus verwendet,
der auch entzerrt. Die Polynomial 1 (Affine) Transformation bewahrt
Kollinearität und erlaubt die Skalierung, Übersetzung und Rotation des Layers.  
\item \textbf{Thin Plate-Spline (TPS)}: Der Thin Plate-Spline (TPS)
Algorithmus stellt eine moderne Methode zur
Georeferenzierung dar und ermöglicht eine lokale Entzerrung der Daten. Die
Anwendung ist besonders dann sinnvoll, wenn die Ausgangsdaten eine schlechte
Qualität haben.
\end{itemize}

\minisec{Durchführung der Transformation}\label{georeferencer_running}

\begin{enumerate}
\item Nachdem die Bezugspunkte (GCPs) gesetzt sind und die Methoder der
Transformation ausgewählt wurde, klicken Sie auf den Knopf
\button{Erstellen}, um das neue Raster zu erstellen, oder auf
\button{Erstellen und Layer laden}, um den neuen Rasterlayer automatisch nach
der Transformation in das QGIS Kartenfenster zu laden.
\item Eine Meldung zeigt dabei an, dass ein neuer Rasterlayer (im GeoTiff
Format) erstellt wird.
\item Nachdem Sie auf den Knopf \button{OK} klicken, werden Sie noch nach der
Resampling Methode gefragt. Hier stehen drei Methoden zur Auswahl:
\begin{enumerate}
\item Nächster Nachbar
\item Linear
\item Kubisch
\end{enumerate}
\end{enumerate}

\begin{Tip}\caption{\textsc{Wahl der Resampling Methode bei der
Geoferenzierung}}
Die ausgewählte Resambling Methode hängt von den Daten und der
späteren Anwendung der Daten ab. Wenn die Statistik des Layers erhalten
bleiben soll, wird wahrscheinlich 'Nächster Nachbar' gewählt, wo hingegen
'Kubisch' im Normalfall ein visuell besseres Ergebnis liefern wird. 
\end{Tip}

