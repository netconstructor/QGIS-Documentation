% vim:autoindent:set textwidth=78:

\section{Arbeiten mit Vektordaten}\label{label_workingvector}
\index{Vektorlayer|(}

% when the revision of a section has been finalized,
% comment out the following line:
% \updatedisclaimer

QGIS unterstützt eine Vielzahl unterschiedlicher Vektorformate, inklusive
allen Formaten, die durch die OGR-Bibliothek unterstützt werden, wie etwa
das ESRI Shape,\index{Shapedaten}\index{ESRI!Shapedaten}\index{SHP Dateien}
MapInfo MIF (Austauschformat)\index{MIF Dateien}\index{MapInfo!MIF Dateien}
und MapInfo TAB (Natives Format).\index{TAB Dateien}\index{MapInfo!TAB
Dateien}. 
Eine Liste von Vektorformaten, die durch die OGR-Bibliothek unterstützt
werden, finden Sie in Anhang~\ref{appdx_ogr}. 

QGIS unterstützt auch PostGIS-Layer\index{PostGIS}\index{PostgreSQL!PostGIS}
in einer PostgreSQL Datenbank mit Hilfe des PostGIS-Plugins. Unterstützung
für weitere Datenformate (z.B.: ASCII-Tabellen oder GPS-Daten) sind mittels
weiterer Plugins realisiert.\index{Getrennter Text}

In diesem Abschnitt wird beispielhaft beschrieben, wie man mit ESRI Shapes
und PostGIS-Ebenen arbeitet. Viele Funktionen in QGIS sind unabhängig vom
verwendeten Datenformat und verhalten sich daher identisch. Dies ist gewollt
und bezieht sich u.a. auf Abfrage, Selektion, Beschriftung und Attributfunktionen.

Das Arbeiten mit GRASS GIS Vektorlayern bildet an manchen Stellen eine Ausnahme
und wird daher in Kapitel \ref{sec:grass} explizit beschrieben.

\subsection{ESRI Shapes}
\index{Vektorlayer!ESRI Shapedateien}
\index{Shapedateien}
\index{ESRI!Shapedateien}
\index{SHP Dateien}

ESRI Shape ist das Standard Vektorformat in QGIS und wird duch die OGR Simple
Feature Library \url{http://www.gdal.org/ogr}\index{OGR} bereitgestellt.
Ein Shape besteht aus mindestens drei Dateien:\index{Shapedateien!Format}

\begin{itemize}
\item .shp Datei (enthält die Geometrien)
\item .dbf Datei (enthält die Attribute im dBase-Format)
\item .shx Datei (enthält den räumlichen Index)
\end{itemize}

Idealerweise existiert noch eine weitere Datei mit .prj Endung. Diese enthält
die Projektionsinformationen des Shapes. Es können noch weitere Dateien zu
einem Shape gehören. Weitere Details finden sich in der technischen
Spezifikation unter \url{http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf}
\index{Shapedateien!Spezifikation}.

\subsubsection{Shape Layer laden}\label{sec:load_shapefile}
Um ein Shape zu laden, starten Sie QGIS und klicken auf das Icon
\toolbtntwo{mActionAddNonDbLayer}{Vektorlayer hinzufügen} in der
Werkzeugleiste\index{Shapedateien!Öffnen} oder mit der Taste \keystroke{V}. Mit
demselben Tool können Sie auch alle anderen durch OGR unterstützten Formate laden.

Beim öffnen des Tools öffnet sich ein Standard-Dialog (Abbildung
\ref{fig:openshapefile}), mit dessen Hilfe Sie in Ihrem Dateisystem
navigieren und die entsprechenden zu ladenden Dateien auswählen können. Die
Auswahlbox \selectstring{Dateien des Typs}{} ermöglicht es, im Vorfeld ein
Format auszuwählen.

\begin{figure}[ht]
   \begin{center}
   \caption{Dialogfenster zum Laden eines OGR-Vektorlayers \nixcaption}\label{fig:openshapefile}\smallskip
   \includegraphics[clip=true, width=14cm]{shapefileopendialog}
\end{center} 
\end{figure}

Durch Auswahl eines Shapes und Anklicken des Knopfes \button{Öffnen} wird die
Datei in QGIS geladen. In Abbildung~\ref{fig:loadedshapefile} sehen Sie das Ergebnis,
nachdem die Beispieldatei \filename{alaska.shp} geladen wurde.

\begin{figure}[ht]
   \begin{center}
   \caption{QGIS mit einem geladenen Alaska Shape \nixcaption}\label{fig:loadedshapefile}\smallskip
   \includegraphics[clip=true, width=16cm]{shapefileloaded}
\end{center} 
\end{figure}

\begin{Tip}\caption{\textsc{Farben von Vektorlayern}}
\qgistip{Wenn Sie einen neuen Vektorlayer in QGIS laden, werden Farben
zufällig zugewiesen. Wenn Sie mehrere neue Vektorlayer laden, werden jeweils
unterschiedliche Farben zugewiesen.
}
\end{Tip}

Nach dem Laden können Sie mit den Navigationstools aus der Werkzeugleiste
beliebig zoomen oder den Layer verschieben. Um den
\dialog{Eigenschaften}-Dialog eines Vektorlayers zu öffnen, doppelklicken Sie
auf den Layernamen in der Legende oder zeigen Sie mit der Maus auf den
Layernamen, drücken Sie die rechte Maustaste und wählen
\dropmenuopt{Eigenschaften}. Vergleichen Sie Abschnitt~\ref{sec:symbology}
für weitere Informationen zum Editieren der Eigenschaften von Vektorlayern.

\subsubsection{Darstellungsgeschwindigkeit optimieren}

Um die Darstellungsgeschwindigkeit zu optimieren, kann ein räumlicher Index
erstellt werden. Ein\index{Räumlicher Index!Shapedateien} räumlicher Index
erhöht die Geschwindigkeit beim Zoomen und Verschieben. Räumliche Indizes
haben in QGIS die Endung \filename{.qix}.

Benutzen Sie folgende Schritte zum Erstellen eines räumlichen Index:

\begin{itemize}
\item Laden Sie ein Shape
\item Öffnen Sie den \dialog{Eigenschaften}-Dialog des Vektorlayers, indem
Sie auf den Namen des Layers in der Legende doppelklicken oder mit der
rechten Maustaste \dropmenuopt{Eigenschaften} auswählen. 
\item In dem Reiter \tab{Allgemein} klicken Sie auf den \button{Erstellen}-Knopf
im Bereich \button{Räumlichen Index erstellen}
\end{itemize}

\subsubsection{MapInfo Layer laden}
\index{Vektorlayer!MapInfo}

Um eine MapInfo Datei zu laden, klicken Sie auf das Icon \texttt{Vektorlayer
hinzufügen} in der Werkzeugleiste oder drücken Sie die Taste \keystroke{V},
geben Sie ein \selectstring{Dateien des Typs}{MapInfo (*.mif *.tab *.MIF *.TAB)}
und wählen die gewünschte Datei aus.

\subsubsection{ArcInfo Coverage laden}
\index{Vektorlayer!ArcInfo Coverage}

Um ein ArcInfo Coverage zu laden, klicken Sie auf das Icon \texttt{Vektorlayer
hinzufügen} in der Werkzeugleiste oder drücken Sie die Taste \keystroke{V},
geben Sie ein \selectstring{Dateien des Typs}{All files (*.*)} und wählen
eine der aufgelisteten Datei aus (falls vorhanden).  

\begin{itemize}
\item .lab - Attributlayer laden (Flächenattribute oder Punktdaten)
\item .cnt - Polygon-Centroid-Layer laden
\item .arc - Linienlayer laden
\item .pal - Polygonlayer laden
\end{itemize}

\subsection{PostGIS Layer laden}
\index{Vektorlayer!PostGIS}
\index{PostGIS!Layer}
\label{label_postgis} 

PostGIS-Ebenen sind in einer PostgreSQL Datenbank gespeichert. Der Vorteil
von PostGIS liegt in der Fähigkeitkeit, räumliche Indizes, Filterungen und
Abfragen bereitszustellen. Vektorfunktionen wie Selektieren und Abfragen
funktionieren besser als bei Ebenen, die durch die OGR-Bibliothek geladen
wurden.

Um PostGIS benutzen zu können, brauchen Sie folgende
Schritte:\index{PostgreSQL!Layer laden}

\begin{itemize}
\item Verknüpfen Sie QGIS mit einer PostgreSQL Datenbank (falls dies noch
nicht geschehen ist)\index{PostgreSQL!Verbindung}
\item Stellen Sie eine Verbindung zur Datenbank her
\item Wählen Sie einen PostGIS Layer aus
\item Optional nutzen Sie eine SQL \usertext{WHERE}-Abfrage, um zu
definieren, welche Objekte des Layers angezeigt werden sollen.
\item Laden Sie den Layer
\end{itemize}

\subsubsection{Erstellen einer PostGIS Anbindung}\index{PostgreSQL!Verbindung}\label{sec:postgis_stored}

Beim ersten Einbinden einer PostGIS-Datenbank muss eine Anbindung erstellt
und gespeichert werden.
Klicken Sie dazu auf den Knopf \toolbtntwo{mActionAddLayer}{PostGIS-Layer
hinzufügen} in der Werkzeugleiste oder aus dem Menü \mainmenuopt{Layer}. 
Der \texttt{PostGIS Tabelle(n) hinzufügen}-Dialog erscheint daraufhin. Um
eine neue Anbindung zu erstellen, klicken Sie auf den Knopf \button{Neu}. Der
Dialog \dialog{Neue PostGIS-Verbindung erzeugen} öffnet sich, und Sie können
die notwendigen Parameter aus Tabelle \ref{tab:postgis_connection_parms}
eingeben und speichern.

\begin{table}[h]\index{PostgreSQL!Verbindungsparameter}
\centering
\caption{PostGIS Verbindungsparameter}\label{tab:postgis_connection_parms}\medskip
 \begin{tabular}{|l|p{5in}|}
\hline Name & Ein Name für die Verbindung. Kann derselbe wie für die
Datanbank sein \\
\hline Host \index{PostgreSQL!Host} & Name des Datenbank-Hosts. Dies muss ein
auflösbarer Name für den HOST sein, genau wie beim Benutzen von telnet oder ping \\
\hline Datenbank \index{PostgreSQL!Datenbank} & Name der Datenbank  \\
\hline Port \index{PostgreSQL!Port}& Port Nummer der Datenbank auf dem
Server. Standard ist 5432.\\
\hline Benutzername \index{PostgreSQL!Benutzername}& Benutzername, um sich bei
der Datenbank anzumelden \\
\hline Passwort \index{PostgreSQL!Passwort}& Passwort, um sich als Benutzer
mit der Datenbank zu verbinden\\
\hline
\end{tabular}
\end{table}

Optional können noch die folgenden Kontrollkästchen aktiviert werden:

\begin{itemize}
\item \checkbox{Passwort speichern}
\item \checkbox{Nur in geometry\_columns nachschauen}
\item \checkbox{Nur im 'public' Schema nachschauen}
\end{itemize}

Wenn alle Parameter eingetragen sind, kann die Verbindung getestet werden,
indem Sie auf den Knopf \button{Teste Verbindung}
drücken\index{PostgreSQL!Verbindung!Testen}. 

\begin{Tip}\caption{\textsc{QGIS Benutzereinstellungen und Sicherheit}}
\index{Einstellungen}\index{Sicherheit} \qgistip{Ihre Einstellungen für QGIS werden
abhängig von Ihrem Betriebssystem gespeichert. Unter \nix ist dies in Ihrem
Homeverzeichnis unter .qt/qgisrc. Unter \win ist es in der Registry. Abhängig
von Ihrer Arbeitsumgebung kann das Speichern von Passworten in den
QGIS-Einstellungen ein Sicherheitsrisiko darstellen.
}
\end{Tip}

\minisec{Laden eines Layers aus der PostGIS Datenbank}\index{PostgreSQL!Layer
laden}

Nachdem Sie eine oder mehrere Verbindungen definiert und gespeichert haben,
können Sie einzelne Ebenen aus PostGIS laden. Natürlich brauchen Sie dazu
Daten in PostgreSQL/PostGIS. Eine Beschreibung zum Import von Daten nach
PostgreSQL/PostGIS lesen Sie Abschnitt \ref{sec:loading_postgis_data}.

Um eine Ebene aus PostGIS zu laden, führen Sie folgende Schritte durch:

\begin{itemize}
\item Wenn der \dialog{PostGIS Tabelle(n) hinzufügen}-Dialog noch nicht
geöffnet ist, klicken Sie auf den Knopf
\toolbtntwo{mActionAddLayer}{PostGIS-Layer hinzufügen} in der Werkzeugleiste
\item Wählen Sie eine Verbindung aus dem Drop-Down Menü und klicken auf
\button{Verbinden}
\item Suchen Sie einen Layer, den Sie laden möchten
\item Wählen Sie den Layer durch doppelklicken aus. Sie können mehrere Ebenen
auswählen, indem Sie die \keystroke{Shift}-Taste beim Auswählen gedrückt
halten. Weitere Informationen, z.B. zum Umgang mit dem PostgreSQL
Query-Builder finden Sie in Abschnitt~\ref{sec:query_builder}.
\item Klicken Sie auf den \button{Hinzufügen}-Knopf, um den Layer zu laden.
\end{itemize}

\begin{Tip}\caption{\textsc{PostGIS-Layer}}
\qgistip{Normalwerweise ist ein PostGIS-Layer über einen Eintrag in der
geometry\_columns Tabelle definiert. Seit Version 0.9.0 ist QGIS in der Lage,
Layer zu laden, die keinen Eintrag in der geometry\_columns Tabelle
besitzen. Dies bezieht sich auf Tabellen und Views. Um einen 'spatial view' zu
definieren, brauchen Sie ein kraftvolles System, um die Daten zu
visualisieren. Beziehen Sie sich auf das PostgreSQL Handbuch, um weitere
Informationen über die Erstellung von Views zu erhalten.}
\end{Tip}

\subsubsection{Einige Details zu PostGIS-Layern}\label{sec:postgis_details}
\index{PostgreSQL!Layerdetails}

Dieser Abschnitt enthält einige Details, wie QGIS auf PostgreSQL zugreift.
Meistens soll QGIS eine Liste mit ein paar Datenbanktabellen bereitstellen,
die bei Bedarf geladen werden können. Wenn Sie Probleme mit dem Laden von
Layern aus PostgreSQL haben, können die nun folgenden Informationen
vielleicht eine Hilfe sein, die Fehlermeldungen von QGIS besser zu verstehen
und eine Lösung zu finden, die PostgreSQL Tabellen- oder Viewdefinition
anzupassen, und somit den Layer laden zu können.

QGIS braucht eine Spalte in der PostgreSQL Tabelle, die als eindeutiger
Schlüssel für den Layer genutzt werden kann. Für Tabellen bedeutet dies, dass
die Tabelle normalerweise einen Primärschlüssel braucht oder eine Spalte mit
eindeutiger Zuordnung. Für QGIS muss diese Spalte außerdem vom Typ int4 sein
(Integer mit 4 Bytes). Wenn eine Tabelle diese Voraussetzungen nicht
erfüllt, wird die oid-Spalte genutzt. Die Performanz steigt, wenn für die
Spalte ein Index erstellt wurde (für Primärschlüssel wird in PostgreSQL
automatisch ein Index erstellt).

Wenn der PostGIS-Layer ein View ist, gelten dieselben Anforderungen, aber
Views besitzen keinen Primärschlüssel oder Spalten mit eindeutiger Zuordnung.
In diesem Fall wird QGIS versuchen, eine passende Spalte zu finden, die aus
der Tabellenspalte erstellt wurde. Wenn so eine Spalte nicht existiert, wird
die Ebene nicht geladen. In diesem Fall ist eine Lösung, den View anzupassen,
damit er eine entsprechende Spalte vom Typ int4 enthält, entweder mit einem
Primärschlüssel oder eindeutiger Zuordnung und bevorzugt natürlich mit Index.

\subsubsection{Layer nach PostgreSQL/PostGIS importieren}\label{sec:loading_postgis_data}
\index{PostGIS!SPIT!Daten importieren}

\minisec{shp2pgsql}
Layer können auf unterschiedliche Art nach PostGIS importiert werden.
PostGIS selbst stellt ein Tool \filename{shp2pgsql} bereit, das genutzt
werden kann, um Shapes nach PostGIS zu importieren. Um ein Shape mit dem
Namen \filename{alaska.shp} in eine PostgreSQL/PostGIS Datenbank zu
importieren, wird folgendes Kommando benutzt:

\begin{verbatim} 
  shp2pgsql -s 2964 alaska.shp alaska_new | psql gis_data
\end{verbatim}

Dieser Befehl erzeugt eine neue Tabelle mit dem Namen \usertext{alaska\_new}
in der PostgreSQL/PostGIS Datenbank \usertext{gis\_data}. Die neue Ebene wird
die ID 2964 als 'spatial reference identifier' (SRID) tragen. Weitere
Informationen zu räumlichen Referenzsystemen finden Sie in Abschnitt
\ref{label_projections}.

\begin{Tip}
\caption{\textsc{PostGIS-Layer exportieren}\index{PostGIS!Exportieren}}
\qgistip{Entsprechend dem Importtool \usertext{shp2pgsql} gibt es auch ein
Exporttool, um Daten von PostGIS ins Shape-Format zu exportieren:
\usertext{pgsql2shp}. Dieses Tool ist in der PostGIS-Installation enthalten.}
\end{Tip}

\minisec{SPIT Plugin}

QGIS bietet ein Plugin mit dem Namen SPIT (Shapefile to PostGIS Import
Tool)\index{PostGIS!SPIT}. SPIT kann dazu
benutzt werden, gleichzeitig mehrere Shapes zu laden und bietet dabei auch
Support für Schemas. Um das Plugin zu benutzen, öffnen Sie
\dropmenuopttwo{mActionShowPluginManager}{Plugins verwalten} im Menü
\mainmenuopt{Plugins}, wählen das \checkbox{SPIT} aus und drücken auf
\button{OK}. Das SPIT-Icon wird nun in der Plugin-Werkzeugleiste
angezeigt\index{PostGIS!SPIT!laden}.

Klicken Sie nun auf das \toolbtntwo{spiticon}{SPIT}-Icon in der
Werkzeugleiste, um den Dialog \dialog{Shapefile nach PostGIS Import Tool} zu
öffnen. Wählen Sie über den Knopf \button{Verbinden} eine PostGIS Datenbank
aus, fügen Sie dann mit dem Knopf \button{Hinzufügen} ein oder mehrere
Shapes zu der Liste hinzu und klicken dann für den Import auf den Knopf
\button{OK}. Der Fortschritt des Imports sowie Warnungen oder Fehlermeldungen
werden für jedes Shape angezeigt.

\begin{Tip}\caption{\textsc{Shapes mit für PostgreSQL reservierten
Ausdrücken importieren}}\index{PostGIS!SPIT!reservierte Ausdrücke}
\qgistip{Wenn Sie ein Shape in der Liste zu importierender Daten haben,
welches Felder mit für PostgreSQL reservierten Ausdrücken enthält, erscheint
ein Popup mit dem jeweiligen Status der Felder. Sie können die Namen der Felder
\index{PostGIS!SPIT!Spaltennamen editieren} dann vor dem Import editieren und
anpassen. Der Versuch die Datei ohne Änderung zu importieren, wird sehr
wahrscheinlich fehlschlagen.}
\end{Tip}

\minisec{ogr2ogr}

Abgesehen von \filename{shp2pgsql} und \filename{SPIT} gibt es noch ein weiteres
Tool, um Daten nach PostGIS zu importieren: \filename{ogr2ogr}. Dieses Tool ist
Teil der GDAL-Installation. Um ein Shape nach PostGIS zu importieren, kann
folgendes Kommando verwendet werden:

\begin{verbatim}
  ogr2ogr -f "PostgreSQL" PG:"dbname=postgis host=myhost.de user=postgres \
  password=topsecret" alaska.shp
\end{verbatim}

Damit wird das Shape \filename{alaska.shp} vom Benutzer \usertext{postgres}
mit dem Passwort \usertext{topsecret} in die PostGIS Datenbank
\usertext{postgis} auf dem Server \usertext{myhost.de} importiert.

Wichtig ist, dass GDAL mit PostgreSQL-Support kompiliert sein muss, damit der
Import nach PostGIS möglich ist. Dies kann mit folgendem Kommando getestet werden:

\begin{verbatim}
ogrinfo --formats | grep -i post
\end{verbatim}

Wenn Sie das PostgreSQL's Kommando \filename{COPY} anstatt der
Standardmethode \filename{INSERT INTO} verwenden möchte, müssen Sie vorher
die folgende Variable exportieren (verifiziert unter \nix und \osx):

\begin{verbatim}
  export PG_USE_COPY=YES
\end{verbatim}

Der Befehl \filename{ogr2ogr} erstellt im Gegensatz zu \filename{shp2pgsl}
keinen räumlichen Index. In diesem Fall müssen Sie ihn nachträglich manuell
erstellen mit dem SQL-Kommando \usertext{CREATE INDEX}. Die Schritte werden
im folgenden Kapitel~\ref{label_improve} näher beschrieben.

\subsubsection{Geschwindigkeit optimieren} \label{label_improve}

Der Datentransfer von einer PostgreSQL/PostGIS Datenbank kann langsam sein,
besonders über ein Netzwerk. Die Geschwindigkeit kann optimiert werden, indem
für alle Ebenen in PostgreSQL ein räumlicher Index\index{PostGIS!Räumlicher
Index} erstellt wird. PostGIS unterstützt das Erstellen eines GiST
(Generalized Search Tree) Index, um den Zugriff auf die Ebenen zu beschleunigen.

Die Syntax zur Erstellung eines GiST\footnote{Die GiST Index Informationen wurden
aus der PostGIS Dokumentation übernommen unter:
\url{http://postgis.refractions.net}} Index ist:

\begin{verbatim}
    CREATE INDEX [indexname] ON [tablename] 
      USING GIST ( [geometryfield] GIST_GEOMETRY_OPS );
\end{verbatim}

Bedenken Sie, dass das Erstellen eines Index bei großen Datenmengen
zeitaufwendig ist. Nachdem der Index erstellt ist, sollte ein
\usertext{VACUUM ANALYZE} durchgeführt werden (vgl. PostGIS Dokumentation
\cite{PostGISweb}).

Im Folgenden sehen Sie ein Beispiel, um einen GiST-Index zu erstellen:

\begin{verbatim}
gsherman@madison:~/current$ psql gis_data
Welcome to psql 8.3.0, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
        \h for help with SQL commands
        \? for help with psql commands
        \g or terminate with semicolon to execute query
        \q to quit

gis_data=# CREATE INDEX sidx_alaska_lakes ON alaska_lakes
gis_data-# USING GIST (the_geom GIST_GEOMETRY_OPS);
CREATE INDEX
gis_data=# VACUUM ANALYZE alaska_lakes;
VACUUM
gis_data=# \q
gsherman@madison:~/current$
\end{verbatim}

\subsection{Vektorlayereigenschaften}\label{sec:vectorprops}
\index{Vektorlayer!Layereigenschaften}

Der Dialog \dialog{Layereigenschaften} stellt Einstellungsmöglicheiten und
Informationen zu einem Vektorlayer, seiner Darstellung, Metadaten,
Beschriftungsoptionen, Aktionen und Attributen bereit. Wenn ein Vektorlayer
aus einer PostgreSQL/PostGIS Datenbank geladen wurde, können über den Dialog
\dialog{Layereigenschaften} auch SQL-Abfragen mit dem \dialog{Query Builder}
im Reiter \tab{Allgemein} angewendet werden. Ansonsten müssen Sie für
OGR-unterstützte Formate den \dialog{Query Builder} Dialog über den Knopf
\button{Erweitert...} im Attributtabellen Fenster starten
(vgl.Kapitel~\ref{sec:select_by_query}). Um den Dialog für die
Layereigenschaften zu öffnen, doppelklicken Sie auf den Namen des Layers in
der Legende oder wählen mit der rechten Maustaste \dialog{Eigenschaften} aus.

\begin{figure}[H]
   \begin{center}
   \caption{Dialog zur Einstellung von Vektorlayereigenschaften
\nixcaption}\label{fig:vector_symbology}\smallskip
   \includegraphics[clip=true, width=16cm]{vectorLayerSymbology}
\end{center}
\end{figure}

\subsubsection{Allgemein}\label{vectorgeneraltab}

Der Reiter \tab{Allgemein} im Dialog \dialog{Layereigenschaften} ermöglicht
es, den Anzeigenamen in der Legende zu verändern, einen räumlichen Index für
PostGIS- sowie OGR-Layer zu erstellen, das Koordinatenbezugssystem des Layers
zu definieren und einen Minimum- und Maximumwert für Ma"sstabsabhängiges
Zeichnen festzulegen.

Der Knopf \button{Query Builder} ermöglicht es, SQL-Abfragen an die
Attributdaten des Layers zu richten. Dieser Knopf ist momentan nur bei
PostGIS Layern aktiv. Um den Query Builder auch auf Attributdaten von
OGR-Layern anwenden zu können, müssen Sie die Attributtabelle des
entsprechenden Layers öffnen und dann auf den Knopf \button{Erweitert...}
drücken.

\subsubsection{Darstellung}\label{sec:symbology}
\index{Vektorlayer!Darstellung}

QGIS bietet eine Vielzahl von Funktionen, um die Darstellung von
Vektorobjekten zu kontrollieren. Derzeit sind folgende Legendentypen vorhanden:

\begin{description}
\item[Einfaches Symbol] - eine definierte Darstellung wird allen Objekten des
Layers zugewiesen.\index{Vektorlayer!Darstellung!Einfaches Symbol}
\item[Abgestuftes Symbol] - Objekten eines Layers wird in Abhängigkeit von
einer Attributspalte und einer definierten Anzahl von Klassen eine
Darstellung zugewiesen.\index{Vektorlayer!Darstellung!Abgestuftes Symbol}
\item[Fortlaufende Farbe] - Objekten eines Layers wird anhand von definierten,
numerischen Werten eine fortlaufende Farbe
zugewiesen.\index{Vektorlayer!Darstellung!Fortlaufende Farbe}
\item[Eindeutiger Wert] - eine definierte Darstellung wird jeder Objektklasse
eines Layers anhand einer definierten Attributspalte
zugewiesen.\index{Vektorlayer!Darstellung!Eindeutiger Wert}
\end{description}

\minisec{Stiloption} \label{sec:style_options}
\index{Vektorlayer!Stiloptionen}

Innerhalb des Reiters \tab{Darstellung} können auch Stiloptionen für
Vektorlayer definiert werden. Abhängig vom ausgewählten Legendentyp können
Vektorobjekte auch klassifiziert dargestellt werden. Die folgenden
Stiloptionen stehen zur Verfügung: 

\begin{description}
 \item[Umrandungsstil] - Definition verschiedener Linienarten und auch keine
Linie für Linien und Flächenumrandungen.
 \item[Umrandungsfarbe] - Definition der Farbe für Linien und Umrandunglinien
von Objekten
 \item[Umrandungsbreite] - Definition der Linienbreite für Linien und
Umrandunglinien von Objekten
 \item[Füllfarbe] - Definition der Füllfarbe von Polygonen.
 \item[Füllstil] - Definition des Füllstils von Polygonen. Neben Ausgefüllt
und Nicht gefüllt stehen zahlreiche Schraffurstile und die Möglichkeit eine
eigene Textur in Form eines Bildes zu laden. Wählen Sie dazu
\selectstring{Füllstil}{? Texture}, drücken Sie auf den Knopf \browsebutton
und wählen Sie eine Bilddatei. Aktuell wird als Datenformat \filename{*.jpeg,
*.xpm, und *.png} unterstützt.
\end{description}

Nachdem Sie die Darstellung für den Layer festgelegt haben, können Sie die
Definition als Datei mit der Endung \filename{*.qml} speichern. Dazu drücken
Sie auf den Knopf \button{Stil speichern \ldots} und entsprechend zum Laden
einer Stildefinition auf den Knopf {Stil laden \ldots}.

Wenn Sie möchten, dass immer eine bestimmte Stildefinition verwendet wird, wenn
Sie einen Layer laden, klicken Sie auf den Knopf \button{Als Standard
speichern}. Wenn Sie die Darstellung des Layers verändern, aber lieber wieder
zur abgespeicherten Standard-Stildefinition zurückkehren möchten, drücken Sie
den Knopf \button{Standardstil wiederherstellen}.

\minisec{Transparenz}\label{sec:vect_transparency}
\index{Vektorlayer!Transparenz}

Innerhalb des Reiters \tab{Darstellung} kann auch die Transparenz für den
Layer festgelegt werden. Dazu verschieben Sie den Regler
\slider{Transparenz}{0}{20mm} wie in Abbildung~\ref{fig:vector_symbology} zu
sehen. Dies ist sehr nützlich, wenn Sie mehrere Vektorebenen miteinander
überlagern möchten.

\subsubsection{Metadaten}

Der Reiter \tab{Metadaten} enthält allgemeine Informationen zu dem Layer
inklusive Angaben zu Datentyp, Datenquelle, Anzahl Objekte, Ausdehnung und
Editiermöglichkeiten. Sie finden auch Informationen zur räumlichen Ausdehnung
und zum Koordinatenbezugssystem. 

\subsubsection{Beschriftungen}

Im Reiter \tab{Beschriftungen} können Sie Objekte beschriften und die
Anordnung, den Schriftstil, die Ausrichtung, Pufferung und Position der
Beschriftung festlegen.

Als Beispiel stellen wir die Beschriftung der Karte lakes.shp des QGIS
Beispieldatensatzes \filename{qgis\_example\_dataset} vor:

\begin{enumerate}
\item Laden der Shapes \filename{alaska.shp} und \filename{lakes.shp}
\item Zoomen Sie ein wenig in ein Gebiet mit ein paar Seen
\item Aktivieren die den \filename{lakes} Layer
\item Öffnen Sie den \dialog{Layereigenschaften} Dialog
\item Klicken Sie auf den \tab{Beschriftungen} Reiter
\item Aktivieren Sie die Checkbox \checkbox{Zeige Beschriftungen an}
\item Wählen Sie als \selectstring{Beschreibungsfeld}{NAMES} aus der Attributtabelle
\item Geben Sie eine Beschriftungsvorgabe für Seen ein, die keine
Beschriftung im \guilabel{NAMES} Feld enthalten.
\item Klicken Sie auf \button{Anwenden}.
\end{enumerate}


Nun werden Beschriftungen angezeigt, aber sie sind wahrscheinlich noch zu
gro"s und schlecht plaziert bezogen auf die Objekte des Layers
\filename{lakes}. Klicken Sie auf den Knopf \button{Schrift}, ändern Sie
Schriftart, -stil und -größe. Kl und drücken auf \button{OK}. Ändern Sie
entsprechend auf die \button{Farbe} der Beschriftung.

Um die Position der Beschriftungen zu ändern führen Sie folgende Schritte
durch:

\begin{enumerate}
\item Wählen Sie einen der Knöpfe im Platzierungsfeld. In diesem Beispiel
klicken auf den Knopf \radiobuttonon{Rechts}.
\item Klicken Sie auf den Knopf \button{Anwenden}, um die Veränderungen
zu sehen und schließen Sie dann den Dialog.
\end{enumerate}

Nun sehen die Beschriftungen schon besser aus, aber Sie liegen noch ein wenig
zu nah an den Objekten. Dies können Sie ändern, indem Sie auf Position
klicken und einen X- und Y-Offset einstellen. Mit einem X-Offset mit
dem Wert 5 sind die Beschriftungen wahrscheinlich schon besser lesbar.
Ansonsten passen Sie die Werte entsprechend an.

Die letzte Anpassung der Beschriftung ist das Puffern. Dies bedeutet, dass
die Beschriftung mit einem farblichen Puffer hinterlegt werdem, damit man sie
besser lesen kann. Um die Beschriftungen der Karte \filename{lakes.shp} zu
Puffern sind folgende Schritte notwendig:

\begin{enumerate}
\item Klicken Sie auf Puffer und aktivieren Sie das Kontrollkästchen
\checkbox{Beschriftungen freistellen}.
\item Wählen Sie eine Größe und eine Farbe
\item Klicken Sie auf \button{Anwenden}, um das Ergebnis zu betrachten.
\end{enumerate}

Wenn Sie mit dem Resultat noch nicht glücklich sind, verändern Sie die
Einstellungen weiter, bis es Ihnen gefällt und klicken Sie jeweils immer auf
den Knopf \button{Anwenden}, um es anzuschauen. Ein Puffer der Größe 2 gibt
normalerweise recht ansehnliche Ergebnisse. Sie können die Puffergröße
übrigens auch in Karteneinheiten definieren, wenn Ihnen das besser gefällt.

Als weitere Einstellungen im Reiter \tab{Beschriftungen} ist es möglich, das
Erscheinungsbild der Beschriftungen anhand von Angaben aus der
Attributtabelle des Layers zu ändern. Über die Bereiche Datendefinierter
Stil, Datendefinierter Puffer und Datendefinierte Position können Sie alle
notwendigen Parameter anhand von Inhalten aus Attributspalten definieren.

Beachten Sie, dass es im unteren Bereich auch ein kleines
\classname{Vorschau}-Feld gibt, in dem alle Änderungen angezeigt werden.

\subsubsection{Aktionen auf Basis von Attributen}\index{Aktionen}\label{label_actions}

QGIS bietet die Möglichkeit, Aktionen auf Basis von Attributen einer Ebene
durchzuführen. Dies kann für eine Vielzahl von Aktionen genutzt werden, z.B.
um ein Programm mit Abfragen aus der Attributdatenbank zu füttern oder
Ergebnisse einer Attributabfrage für ein statistisches Tool bereitzustellen.

Aktionen auf Basis von Attributen sind sinnvoll, wenn sie mit externen
Applikationen auf Ergebnisse einer oder mehrerer Attributabfragen von
Vektorlayern zugreifen möchten. Ein Beispiel finden Sie im nächsten Abschnitt.

\minisec{Aktionen definieren}\index{Aktionen!Definition}

Attribut-Aktionen werden im Dialog \dialog{Layereigenschaften} im Reiter
\texttt{Aktionen} definiert. Sie brauchen einen Namen für die Aktion und das
externe Programm, das während der Aktion gestartet werden soll. Sie können
ein oder mehrere Attributfelder einbinden. Alle Zeichen, die mit \% und dem
Namen eines Feldes beginnen, werden durch den Wert dieses Feldes ersetzt. Die
Spezialfelder \%\% \index{\%\%} werden ersetzt durch den Wert des Feldes, der
auf Basis von Abfrageergebnissen selektiert wird (vgl.
Abschnitt~\ref{label_usingactions}). Doppelte Anführungsstriche können dazu
benutzt werden, um mehrere Worte als ein Ausdruck gruppiert zu übergeben.
Doppelte Anführungsstriche werden ignoriert, wenn davor ein Backslash steht.

Wenn in der Attributtabelle Spaltenamen auftreten, die eine Teilzeichenfolge
eines anderen Spaltenamen sind (z.B.: \usertext{Spalte1} and
\usertext{Spalte10}) sollten Sie diese Spaltenamen (und \%-Zeichen) in eckige
Klammern schreiben (z.B.: \usertext{[\%Spalte10]}. Dadurch wird verhindert,
dass die \usertext{[\%Spalte10]} Spalte interpretiert wird als
\usertext{[\%Spalte1]} und einer \usertext{0} am Ende. Die eckigen Klammern
werden von QGIS bei der Ausführung entfernt. Wenn Sie möchten, dass um den
Spaltennamen eine eckige Klammer steht, ergänzen Sie den Ausdruck durch zwei
weitere eckige Klammern: \usertext{[[\%Spalte10]]}.

Das Dialogfenster \dialog{Abfrageergebnisse} enthält auch eine {\em
(abgeleitet)} Information in abhängigkeit vom Layertyp. Die hier angezeigten
Werte können auf ähnliche Weise eingebunden werden, wie Spalten aus der
Attributtabelle, indem vor den erfassten Wert ein \usertext{(abgeleitet).}
gestellt wird. Zum Beispiel: Ein Punktlayer zeigt Felder mit der
\usertext{X}- und \usertext{Y}-Koordinate. Diese können in der Aktion genutzt
werden mit dem Eintrag \usertext{\%(abgeleitet).X} and
\usertext{\%(abgeleitet).Y}. Diese abgeleiteten Aktionen können nur über den
Dialog \dialog{Abfrageergebnisse} angesprochen werden, nicht über
die \dialog{Attributtable}. 

Zur besseren Erläuterung zwei Beispiele:\index{Aktionen!Beispiele}

\begin{verbatim}
    konqueror http://www.google.com/search?q=\%nam
    konqueror http://www.google.com/search?q=\%\%
\end{verbatim}

Im ersten Beispiel wird an den Webbrowser Konqueror eine Google URL
übergeben mit dem Wert eines Feldes \usertext{nam} eines Vektorlayers.
Beachten Sie, dass sich das bei einer Aktion aufgerufene Programm im Pfad
befinden muss. Ansonsten müssen Sie den gesamten Pfad angeben:

\begin{verbatim}
/opt/kde3/bin/konqueror http://www.google.com/search?q=\%nam
\end{verbatim}

Das zweite Beispiel nutzt den Ausdruck \%\%, welcher unabhängig ist von einem
speziellen Feld. Beim Ausführen des Befehls wird der Ausdruck \%\% durch den
Wert des jeweils selektierten Feldes ersetzt.

\minisec{Aktionen anwenden}\index{Aktionen!anwenden}\label{label_usingactions}

Aktionen können entweder über den Dialog \dialog{Abfrageergebnisse} oder die
geöffnete \dialog{Attributtabelle} gestartet werden. Beide Dialoge sind per
Maus erreichbar über \toolbtntwo{mActionOpenTable}{Abfrageergebnisse} oder
\toolbtntwo{mActionOpenTable}{Attributtabelle öffnen}.) Um eine Aktion
aufzurufen, klicken Sie mit der rechten Maustaste auf einen Eintrag in der
Attributtabelle und wählen die gewünschte Aktion aus der Liste aus.

Wenn eine Aktion mit dem Ausdruck \%\% gestartet werden soll, klicken Sie mit
der rechten Maustaste auf einen Eintrag in der \dialog{Attributtabelle} oder im
Dialog \dialog{Abfrageergebnisse} und wählen die gewünschte Aktion aus der
Liste aus.

In einem weiteren Beispiel soll gezeigt werden, wie Attributwerte aus eines
Vektorlayers abgefragt und in eine Textdatei mit Hilfe der Bash und des
\usertext{echo} Kommandos geschrieben werden (funktioniert also nur unter
\nix und evtl. \osx). Der Abfragelayer enthält die Felder Art
\usertext{taxon\_name}, Latitude \usertext{lat} und Longitude
\usertext{long}. Um eine räumliche Abfrage eines Ortes zu erstellen und die
Werte der drei Felder in eine Textdatei zu schreiben, wird folgende Aktion
erstellt:

\begin{verbatim}
  bash -c "echo \"%taxon_name %lat %long\" >> /tmp/species_localities.txt"
\end{verbatim} 

Nachdem ein paar Orte auf dem Bildschirm ausgewählt wurden (diese erscheinen
gelb hinterlegt), starten wir die Aktion mit der rechten Maustaste über den
Dialog \dialog{Abfrageergebnisse} und können danach in der Textdatei die
Ergebnisse ansehen:

\begin{verbatim}
  Acacia mearnsii -34.0800000000 150.0800000000
  Acacia mearnsii -34.9000000000 150.1200000000
  Acacia mearnsii -35.2200000000 149.9300000000
  Acacia mearnsii -32.2700000000 150.4100000000
\end{verbatim} 

Als Übung erstellen wir eine Aktion, bei der Google nach dem Namen des
jeweiligen Sees in dem Layer \filename{lakes} sucht. Als erstes geben wir die
URL ein, die wir brauchen, um auf Basis eines Schlüsselwortes zu suchen. Das
ist einfach, in dem wir einfach auf der Google Webseite nach einem Begriff
suchen und die URL dann kopieren. Das Format, das wir brauchen ist:
\url{http://google.com/search?q=qgis}, wobei \usertext{qgis} das
Schlüsselwort ist, nach dem wir suchen wollen. Nun kann es weiter gehen:

\begin{itemize}
\item Laden Sie den Layer \filename{lakes.shp}
\item Öffnen Sie die \dialog{Layereigenschaften} Dialog, indem Sie doppelt
auf den Layernamen \filename{lakes} in der Legende klicken oder wählen Sie
das Menü \dropmenuopt{Eigenschaften} mit der rechten Maustaste.
\item Klicken Sie auf den Reiter \tab{Aktionen}
\item Geben Sie einen Namen für die Aktion ein, z.B: \usertext{Google Search}
\item Für diese Aktion ist es notwendig, den Namen des externen Programms
anzugeben, mit  dem wir das Ergebnis anzeigen lassen wollen. In unserem Fall
wählen wir Firefox als Webbrowser.
\item Hinter dem Namen des Programms geben wir die URL ein, die wir für die
Internetsuche benutzen wollen, aber ohne das Schlüsselwort:
\url{http://google.com/search?q=}
\item Der Text im Feld \guilabel{Aktion} sollte nun folgendermaßen aussehen:\\
\usertext{firefox http://google.com/search?q=}
\item Klicken Sie nun auf die Drop-Down Box mit den Spaltennamen der
Attributtabelle des Layers \filename{lakes}. Der Knopf ist gleich links neben
dem Knopf \usertext{Attribut einfügen}.
\item Wählen Sie die Attributspalte \selectstring{}{NAMES} und klicken auf
\button{Attribut einfügen}.
\item Die Aktion sieht nun so aus:\\ \usertext{firefox
  http://google.com/search?q=\%NAMES}
\item Abschließend drücken Sie auf \button{Aktion hinzufügen}.
\end{itemize}

Damit ist die Aktion fertig für den Einsatz. Der gesamte Befehl der Aktion
sollte folgendermaßen aussehen:

\begin{center}
\usertext{firefox \url{http://google.com/search?q=\%NAMES}}
\end{center}

Wir können die Aktion nun benutzen. Schließen Sie den \dialog{Eigenschaften}
Dialog und zoomen Sie in eine Bereich ihrer Wahl mit ein paar Seen. Stellen Sie
sicher, dass der Layer \filename{lakes} in der Legende aktiviert ist. Nun
identifizieren Sie einen See. In der Ergebnisanzeige sollte nun die Aktion
sichtbar sein:

\begin{figure}[H]
   \begin{center}
   \caption{Auswählen eines Objektes mit einer Aktion \nixcaption}\label{fig:identify_action}\smallskip
   \includegraphics[clip=true, width=6cm]{action_identifyaction} 
\end{center}  
\end{figure}

Wenn wir nun auf das Wort \usertext{action} klicken, öffnet sich der
Webbrowser Firefox und zeigt uns das Ergebnis der Internetrecherche z.B. nach
dem See Tustumena an \url{http://www.google.com/search?q=Tustumena}. Es ist
übrigens auch möglich, weitere Attributspalten zu ergänzen. Dazu fügen Sie
einfach ein ``+''-Zeichen an das Ende der Aktion, wählen eine weitere
Attributspalte und klicken wieder auf den Knopf \texttt{Attribut einfügen}.
In unserem Datensatz ist leider keine weitere sinnvolle Attributspalte
vorhanden, nach der man im Internet suchen könnte.

Sie können auch mehrere Aktionen für einen Layer definieren. Sie alle werden
dann bei der Abfrage von Objekten im Dialog \dialog{Abfrageergebnisse}
angezeigt und können ausgewählt und benutzt werden. Sie können auch eine
Aktion starten, in dem Sie in der Attributtabelle in eine Zeile gehen und mit
der rechten Maustaste eine Aktion für genau diesen einen Eintrag ausführen.

Sie sehen, man kann sich eine Vielzahl interessanter Aktionen ausdenken. Wenn
Sie z.B. einen Punktlayer mit einzelnen Punkten haben, an denen Photos
geschossen wurden, dann können Sie eine Aktion erstellen, über die Sie dann
das entsprechende Photo anzeigen lassen können, wenn Sie auf den Punkt in der
Karte klicken. Man kann auch zu bestimmten Attributen webbasierte
Information ablegen (z.B. in einer HTML-Datei) und diese dann
über eine Aktion anzeigen lassen, etwa so wie in dem Google Beispiel.

\subsubsection{Attribute}\index{Attribute}\label{label_attributes}

Innerhalb des Reiters \tab{Attribute} kann die Eingabe von Attributwerten für
den Layer beinflusst werden. Aktuell können nur PostGIS-Layer editiert
werden, da diese Funktion noch nicht durch GDAL/OGR unterstützt wird. Wenn
Sie auf den Knopf \button{Bearbeitungsmodus umschalten} klicken, können Sie
für PostGIS Daten auch die Knöpfe \button{Neue Attributspalte} und
\button{Lösche Attributspalte} nutzen. 

\minisec{Feld zur Definition der Eingabe in eine Spalte}

Innerhalb des des Reiters \tab{Attribute} gibt es auch eine Feld
\usertext{Eingabefeld} und ein Feld \usertext{Werte}. Diese beiden Felder
können verwendet werden, um Werte oder Wertebereiche zu definieren, die
während des Editierens einer bestimmten Attributspalte erlaubt sind. Auf
Grundlage der Einträge werden unterschiedliche Eingabefenster während des
Editierens erstellt:

\begin{itemize}
\item Texteingabe: Eingabefeld für einfachen Text (oder numerische Attribute).
\item Eindeutige Werte: Eingabefeld für eine Liste eindeutiger, bereits
enthaltener Attributwerte die in einer Combobox auswähbar sind.
\item  Eindeutige Werte (änderbar): Eingabefeld mit einer Kombnation aus
Texteingabe und Eindeutige Werte. Das Eingabefeld vervollständigt
eingetragene zu eindeutigen Werten, erlaubt aber auch neue Werte.
\item Wertabbildung: Eingabefeld für eine Combobox mit Werten, die zuvor im
Feld \usertext{Werte} des Reiters \tab{Attribute} definiert wurden. Mögliche
Werte sind (z.B.: \verb|high;medium;low|). Es ist auch möglich, den Werten ein
auf ein gleiches Zeichen limitiertes Zeichen voranzustellen (z.B.:
\verb|high=1;medium=2;low=3|). Das Zeichen und nicht der Wert wird dann in
der Combobox angezeigt.
\item Klassifizierung: Wenn eindeutige Werteklassen für den Layer vorliegen,
werden diese Werteklassen zur Selektion in einer Combobox dargestellt.
\item Bereich (änderbar): Eingabefeld, in dem festgelegte Zahlenwerte eines
Wertebereichs definiert sind. Der Wertebereich wird durch einen Minimum und
einen Maximumwert im Feld \usertext{Werte} des Reiters \tab{Attribute}
definiert und durch Semikolon getrennt (z.B.: \verb|0;360|).
\item Bereich (Schieberegler): Ein Schieberegler, der die Auswahl eines zuvor
festgelegten Wertespanne ermöglicht. Der Wertebereich wird durch einen
Minimum, einen Maximumwert und eine Schrittweite im Feld \usertext{Werte} des
Reiters \tab{Attribute} definiert und durch Semikolon getrennt (e.g.
\verb|0;360;10|).
\item Dateiname: Das Eingabefeld enthält einen \button{Knopf}, der es erlaubt
eine Datei anzugeben.
\end{itemize}

\subsection{Editierfunktionen}\index{Editierfunktionen}

QGIS bietet einfache Editierfunktionen für Vektordaten. Bevor Sie
weiterlesen sollten Sie sich bewusst sein, dass derzeit nicht alle
Funktionen ausgereift sind. Bevor Sie also anfangen, Vektorlayer zu
editieren, sollten Sie die Daten sichern.

\textbf{Bemerkung}: Die Vorgehensweise zum Editieren von GRASS Vektorlayern
ist anders und wird in Kapitel~\ref{grass_digitising} beschrieben.

\subsubsection{Einstellen der Fangtoleranz und des Suchradius}

Bevor wir damit beginnen können, Vektorgeometrien zu editieren, ist es sehr
wichtig die Fangtoleranz und den Suchradius für Stützpunkte (Vertices)
festzulegen, um optimale Ergebnisse zu erzielen. 

\minisec{Fangtoleranz}

Die Fangtoleranz ist der Abstand, den QGIS verwendet, um beim digitalisieren den
nächstgelegenen Stützpunkt bzw. das nächstgelegene Liniensegment zu suchen
und sich damit zu verbinden. Wenn Sie sich nicht innerhalb der definierten
Fangtoleranz befinden, wird der Stützpunkt dort gesetzt, wo sich der
Mauszeiger gerade befindet, wenn Sie die Maustaste drücken, ohne darauf zu
achten, dass Linienzüge und Flächen geschlossen sind. Es gibt zwei
Möglichkeiten, die Fangtoleranz einzustellen:

\begin{enumerate}
\item Ein allgemeiner, projektweiter Fangmodus kann im Menü
\mainmenuopt{Einstellungen} > \dropmenuopttwo{mActionOptions}{Optionen}
eingestellt werden. Im Reiter \tab{Digitalisierung} können Sie auswählen, ob
sich der Fangmodus auf Stützpunkte, Segmente oder auf Stützpunkte und
Segmente beziehen soll. Sie können auch in Layereinheiten definieren, welchen
Wert die voreingestellt Fangtoleranz und der Suchradius haben soll. Wenn Sie
mit den Alaska-Daten arbeiten bezieht sich die Layereinheit auf
\usertext{feet} und ein Wert von etwa 300ft bei einem Maßstab 1:10 000 sollte
für die Übungen gut funktionieren.
\item Eine Layer-basierter Fangmodus kann festgelegt werden im Menü
\mainmenuopt{Einstellungen} >
\dropmenuopttwo{mActionOptions}{Projekteinstellungen}. Im Reiter
\tab{Allgemein}, Sektion \classname{Digitalisierung} können Sie auf den Knopf
\button{Snapping Optionen} drücken und für jeden in QGIS geladenen
Vektorlayer einen Fangmodus und Fangtoleranz einstellen, aktivieren oder
deaktivieren (vgl. Abbildung~\ref{fig:snappingoptions}).
\end{enumerate}

\begin{figure}[H]
   \begin{center}
   \caption{Fangmodus und -toleranz der Vektorlayer einstellen \nixcaption}\label{fig:snappingoptions}\smallskip
   \includegraphics[clip=true, width=14cm]{editProjectSnapping} 
\end{center}  
\end{figure}

\minisec{Suchradius}

Der Suchradius ist die Distanz, mit der QGIS die nächstgelegenen Stützpunkte
zum Mauszeiger findet. Wenn der Mauszeiger sich nicht innerhalb des Suchradius
befindet, wird kein Stützpunkt gefunden, solange Sie nicht wirklich
direkt auf einen treffen, um diesen z.B. zu verschieben, zu löschen oder
anderweitig zu editieren. Beide Parameter, Fangtoleranz und Suchradius sind
in Layereinheiten zu definieren und es kann gut sein, dass Sie für ihre
Ansprüche ein wenig mit den Werten experimentieren müssen. Dies gilt
besonders, wenn es eine große Anzahl von Stützpunkten auf kleiner Fläche
sind. 

Der Suchradius zum Editieren von Stützpunkten kann eingestellt werden im
Reiter \tab{Digitalisierung} des Menüs \mainmenuopt{Einstellungen} >
\dropmenuopttwo{mActionOptions}{Optionen}. Derselbe Ort, an dem auch die
Fangtoleranz und der Fangmodus definiert werden.  

\subsubsection{Topologisches Editieren}

Abgesehen von der Einstellung des Layer-basierten Fangmodus können im Reiter
\tab{Allgemein} im Menü \mainmenuopt{Einstellungen} >
\dropmenuopttwo{mActionOptions}{Projekteigenschaften} auch topologische
Funktionalitäten eingestellt werden. In der Sektion
\classname{Digitalisierung} können Sie \checkbox{Ermögliche topologisches
Editieren} und/oder \checkbox{Vermeide Überschneidung neuer Polygone} aktivieren.

\minisec{Ermögliche topologisches Editieren}

Das Kontrollkästchen \checkbox{Ermögliche topologisches Editieren}
unterstützt das Editieren und Kontrollieren gemeinsamer Grenzlinien in
Polygon-Layern. QGIS 'erkennt' gemeinsame Flächengrenzen und beim Verschieben
des Stützpunktes einer Fläche werden dann automatisch die anderen
Flächengrenzen angepasst und mit verschoben.

\minisec{Vermeide Überschneidung neuer Polygone}

Als zweite topologische Funktion gibt es das Kontrollkästchen
\checkbox{Vermeide Überschneidung neuer Polygone}. Damit wird es vereinfacht,
angrenzende Polygone zu digitalisieren. Wenn bereits ein Polygon digitalisiert
wurde, kann das zweite auch mit einer Überlagerung des ersten Polygons
erstellt werden und QGIS schneidet dann die Überlagerungen weg, so dass die
Flächen exakt aneinander liegen. Der Vorteil ist, dass nicht alle Stützpunkte
einer gemeinsamen Grenzlinie digitalisiert werden müssen.

\subsubsection{Einen vorhandenen Layer editieren}
\index{Vektorlayer!Editierfunktionen}
\index{Editierfunktionen!existierender Layer}
\label{sec:edit_existing_layer}

Standardmäßig lädt QGIS Vektorlayer im 'read-only' Modus, um ungewolltes
Editieren zu verhindern. Ansonsten können aber alle Ebenen editiert werden,
wenn es der Datenanbieter erlaubt bzw. die Rechte entsprechend gesetzt sind.
Das Editieren von Vektorlayern ist am vielseitigsten bei PostgreSQL/PostGIS
Daten. 

\begin{Tip}[h]\caption{\textsc{Daten-Integrität}}
\qgistip{Bitte beachten Sie, Daten vor und während des Editierens regelmäßig
zu sichern, um bei Fehlern keine unnötigen Verluste zu erleiden. Auch wenn
QGIS mittlerweile sehr stabil ist, was die Daten-Integrität betrifft, sollten
Sie sich nicht darauf verlassen
}
\end{Tip}

\begin{Tip}[ht]\caption{\textsc{Attributdaten manipulieren}}
\qgistip{Momentan wird nur für PostGIS-Layer das Hinzufügen und Löschen von
Attributspalten unterstützt. In zukünftigen Version wird diese Funktion auch
für andere Daten unterstützt, da diese erst kürzlich in GDAL/OGR > 1.6.0
implementiert wurde. Ohne jegliche Garantie kann als Notlösung solange das
externe Python Plugin 'Table Manager' verwendet werden.
}
\end{Tip}

\begin{Tip}[ht]\caption{\textsc{Regelmäßiges Sichern der Daten}}
\qgistip{Bitte schließen Sie die Option
\toolbtntwo{mActionToggleEditing}{Bearbeitungsmodus ändern} regelmäßig.
Dadurch werden alle bis dahin gemachten Änderungen gespeichert und es ist
sichergestellt, dass die Änderungen auch akzeptiert werden.
}
\end{Tip}

\begin{Tip}[h]\caption{\textsc{Zeitgleiches Editieren}}
\qgistip{Diese QGIS Version kontrolliert nicht, ob zwei Personen gleichzeitig
an einem Vektorlayer arbeiten. Die zuletzt schreibende Person gewinnt.
}
\end{Tip}

\begin{Tip}[h]\caption{\textsc{Zoomen zum letzten Editierstand}}
\qgistip{Vor dem Editieren eines Vektorlayers sollten Sie in den Bereich
zoomen, den Sie verändern möchten. Dadurch wird die zeitaufwendige
Darstellung sämtlicher Knotenpunkte des Vektorlayers im Kartenfenster
verhindert.
}
\end{Tip}

\begin{Tip}[h]\caption{\textsc{Stützpunktsymbol ändern}}
\qgistip{QGIS ermöglicht es, das Symbol für die Stützpunkte zu verändern. Sie
können wählen zwischen einem Kreuz und einem halbtransparenten Kreis. Zum
Ändern gehen Sie in das Menü \mainmenuopt{Einstellungen} >
\dropmenuopttwo{mActionOptions}{Optionen} und wählen im Reiter
\tab{Digitalisierung} das entsprechende Symbol. 
}
\end{Tip}

Vor jedem Editieren eines Vektorlayers muss dieser in der Legende ausgewählt
werden und die Option 
\dropmenuopttwo{mActionToggleEditing}{Bearbeitungsstatus umschalten} in der
Werkzeugleiste aktiviert sein. Alternativ können Sie dazu auch mit der
rechten Maustaste auf den Namen des Layers in der Legende klicken und die
Option im Kontextmenü auswählen. Sobald der Layer im Bearbeitungsstatus ist,
erscheinen die Stützpunkte als das von Ihnen gewählte Stützpunktsymbol und
zusätzlich werden die Digitalisier-Tools in der Werkzeugleiste
aktiv.\index{Editierfunktionen!Icons}


\minisec{Mit dem Mausrad im Kartenfenster zoomen}

Während des Digitalisierens können Sie mit dem Mausrad in das Kartenfenster
hinein- und hinauszoomen, indem Sie den Mauszeiger auf einen Kartenbereich
platzieren und das Mausrad nach vorne (weg von Ihnen) zum Hineinzoomen oder
nach hinten (näher an Sie heran) zum Hinauszoomen bewegen. Die Position des
Mauszeigers ist dabei das Zentrum des Zoomvorgangs. Sie können das
Zoomberhalten des Mausrades in dem Reiter \tab{Kartenwerkzeuge} des Menüs
\mainmenuopt{Einstellungen} > \dropmenuopt{Optionen} verändern.

\minisec{Den Layer mit den Pfeiltasten im Kartenfenster verschieben}

Das Verschieben des Layers im Kartenfenster während des Digitalisierens ist
mit den Pfeiltasten möglich. Plazieren Sie den Mauszeiger in das
Kartenfenster und drücken Sie rechte Pfeiltaste, um den Layer nach Osten zu
verschieben, die linke Pfeiltaste für Westen, die Pfeiltaste nach unten für
Süden und die Pfeiltaste nach oben für das Verschieben nach Norden. 

Sie können auch die gedrückte Leer-Taste dazu verwenden, um den Layer im
Kartenfenster zu verschieben, wenn Sie mit dem Mauszeiger darübergehen. Die
Leer-Taste übernimmt dabei die Aufgabe der linken Maustaste. Zum Hinein- und
Herauszoomen können Sie übrigens auch die \keystroke{BildHoch} und
\keystroke{BildRunter} Tasten verwenden, so wie Sie es ansonsten mit dem
Mausrad tun können.

All diese Funktionen ermöglichen es Ihnen, in einem Layer zu zoomen oder
diesen zu verschieben, ohne das Sie das Digitalisieren unterbrechen müssen.

Folgende Digitalisier-Tools stehen Ihnen zur Verfügung:

\begin{itemize}
\item \toolbtntwo{mActionCapturePoint}{Punkt digitalisieren}
\item \toolbtntwo{mActionCaptureLine}{Linie digitalisieren} 
\item \toolbtntwo{mActionCapturePolygon}{Polygon digitalisieren}
\item \toolbtntwo{mActionAddRing}{Ring hinzufügen}
\item \toolbtntwo{mActionAddIsland}{Insel hinzufügen}
\item \toolbtntwo{mActionSplitFeatures}{Objekte trennen}
\item \toolbtntwo{mActionMoveFeature}{Objekte verschieben}
\item \toolbtntwo{mActionMoveVertex}{Stützpunkt verschieben}
\item \toolbtntwo{mActionAddVertex}{Stützpunkt hinzufügen}
\item \toolbtntwo{mActionDeleteVertex}{Stützpunkt löschen}
\item \toolbtntwo{mActionDeleteSelected}{Ausgewähltes löschen}
\item \toolbtntwo{mActionEditCut}{Ausgewählte Objekte ausschneiden}
\item \toolbtntwo{mActionEditCopy}{Objekte kopieren}
\item \toolbtntwo{mActionEditPaste}{Objekte einfügen}
\end{itemize}

\minisec{Objekte hinzufügen}
\index{Vektorlayer!hinzufügen!Objekt}

Bevor Sie mit dem Editieren von Objekten beginnen, benutzen Sie die Tools
\toolbtntwo{mActionPan}{Karte verschieben} und 
\toolbtntwo{mActionZoomIn}{Hineinzoomen}/\toolbtntwo{mActionZoomOut}{Hinauszoomen},
um sich dem Bereich zu nähern, den Sie verändern möchten.

Danach können Sie mit den Icons \toolbtntwo{mActionCapturePoint}{Punkt
digitalisieren}, \toolbtntwo{mActionCaptureLine}{Linie digitalisieren} oder
\toolbtntwo{mActionCapturePolygon}{Polygon digitalisieren} in der
Werkzeugleiste den Mauszeiger in den Digitalisiermodus bringen.

Für jedes Objekt wird erst die Geometrie digitalisiert und dann das Attribut
hinzugefügt. Um eine Geometrie zu digitalisieren, klicken Sie mit der linken
Maustaste an eine gewünschte Stelle im Kartenfenster, um den ersten Punkt zu
erstellen.

Für Linien und Polygone klicken Sie für jeden weiteren Knotenpunkt wieder die
linke Maustaste. Zum Beenden klicken Sie irgendwo im Kartenfenster auf die
rechte Maustaste, um anzuzeigen, dass die Geometrie ihres Objektes fertig
gestellt ist. Dadurch wird das Attributfenster geöffnet und ermöglicht die
Attribute für das neue Objekt einzutragen. In Abbildung
\ref{fig:vector_digitising} ist ein Beispiel für einen fiktiven Fluss in
Alaska gezeigt.

\begin{figure}[ht]
   \begin{center}
   \caption{Eingabe von Attributen nach dem Digitalisieren eines neuen Objektes \nixcaption}\label{fig:vector_digitising}\smallskip
   \includegraphics[clip=true, width=8cm]{editDigitizing}
\end{center}  
\end{figure}

\begin{Tip}[h]\caption{\textsc{Datentyp der Attribute}}
\qgistip{QGIS kontrolliert beim Editieren von Shapes, ob die eingetragenen
Werte dem Datentyp der Attributspalte entspricht (z.B.: Zahl oder Text).
Ansonsten ist es nicht möglich, im Dialog \dialog{Attributwert eingeben}
eine Zahl in eine Textspalte einzutragen, oder umgekehrt. Falls es dennoch
notwendig sein sollte, können Sie es nachträglich im Fenster der
\dialog{Attributtabelle} ändern.
}
\end{Tip}

\minisec{Objekt verschieben}
\index{Vektorlayer!verschieben!Objekt}

Mit dem Werkzeug \toolbtntwo{mActionMoveFeature}{Objekte verschieben} können Sie
komplette Objekte verschieben.

\minisec{Objekte trennen}
\index{Vektorlayer!trennen!Objekt}

Polygone können mit dem Werkzeug \toolbtntwo{mActionSplitFeatures}{Objekte
trennen} 'durchschnitten' werden. Die neu enstehenden Objekte sind dann
jeweils mit den Attributdaten verknüpft. 

\minisec{Stützpunkte eines Objektes editieren}
\index{Vektorlayer!Editierfunktionen!Stützpunkt}

Für PostgreSQL/PostGIS- und Shape-Layer können die Stützpunkte von Objekten
editiert werden. Stützpunkte können direkt editiert werden, ohne vorher
auszuwählen, welches Objekt gemeint ist. In einigen Fällen teilen sich
Objekte dieselben Knotenpunkte. Folgende Regeln kommen daher zum Einsatz:

\begin{itemize}
\item \textbf{Linien}    - Die zum Mauszeiger nächste Linie wird als 
			  Zielobjekt
                          benutzt. Beim Verschieben oder Löschen eines
                          Stützpunktes wird der zum Mauszeiger nächste
			  Stützpunkt auf einer Linie editiert.

\item \textbf{Polygone} - Wenn der Mauszeiger sich innerhalb eines Polygons
                          befindet, ist dies das Zielobjekt, ansonsten wird
			  das
                          zum Mauszeiger nächstliegende Objekt benutzt. Beim
                          Verschieben oder Löschen eines Stützpunktes
                          wird der zum Mauszeiger nächste Stützpunkt auf dem
			  Polygon editiert.
\end{itemize}

Sie sollten den Suchradius beim Digitalisieren über die Menüleiste unter
\mainmenuopt{Einstellungen} > \dropmenuopttwo{mActionOptions}{Optionen} >
\tab{Digitalisierung} größer 0 einstellen. Ansonsten ist QGIS nicht in der
Lage, ein Objekt auszuwählen.

\minisec{Stützpunkte hinzufügen}
\index{Vektorlayer!hinzufügen!Stützpunkt}

Sie können einen Stützpunkt zu einem Objekt hinzufügen, indem Sie das Icon
\toolbtntwo{mActionAddVertex}{Stützpunkt hinzufügen} aus der Werkzeugleiste
auswählen. Beachten Sie, es macht wenig Sinn, weitere Stützpunkte zu einem
Punktobjekt zu ergänzen.

In dieser QGIS Version können Knotenpunkte nur zu \texttt{bereits
vorhandenen} Liniensegmenten einer Linie hinzugefügt werden. Wenn Sie eine
Linie über ihr Ende hinaus verlängern möchten, müssen Sie erst den letzten
Stützpunkt verschieben und können dann weitere Stützpunkte ergänzen.

\minisec{Stützpunkte verschieben}
\index{Vektorlayer!verschieben!Stützpunkt}

Sie können Stützpunkte mit dem Icon \toolbtntwo{mActionMoveVertex}{Stützpunkt
verschieben} aus der Werkzeugleiste verschieben.

\minisec{Stützpunkte löschen}
\index{Vektorlayer!löschen!Stützpunkt}

Sie können einen Stützpunkt aus einem Objekt löschen, indem Sie das Icon
\toolbtntwo{mActionDeleteVertex}{Stützpunkt löschen} aus der Werkzeugleiste
auswählen. Beachten Sie, es macht keinen Sinn, einen Stützpunkt aus einem
Punktobjekt zu löschen. Löschen Sie in dem Fall das Objekt. Ebenso ist eine
Linie, die aus einem Stützpunkt besteht oder ein Polygon, das aus zwei
Stützpunkten besteht sinnlos und führt zu fehlerhaften Ergebnissen.

\textbf{Warnung:} Ein Stützpunkt ist zum Löschen ausgewählt, sobald Sie mit
bei entsprechend gewählten Suchradius der Maus in die Nähe des Stützpunktes
klicken. Um dies rückgänggig zu machen, müssen Sie den Editiermodus verlassen
und bei der Nachfrage, ob die Veränderungen gespeichert werden sollen
\button{Nein} auswählen. Dadurch werden aber natürlich auch alle anderen bis
dahin vorgenommenen Änderungen verworfen.

\minisec{Ring hinzufügen}
\index{Vektorlayer!hinzufügen!Ring}

Sie können Ring-Polygone mit dem Werkzeug \toolbtntwo{mActionAddRing}{Ring
hinzufügen} erstellen. Das bedeutet, dass Sie innerhalb eines bestehenden
Polygons weitere Polygone digitalisieren können. Diese erscheinen dann als
'Loch', so dass nur der Zwischenraum des inneren und des äußeren Polygons als
Ring-Polygon übrig bleibt.

\minisec{Insel hinzufügen}
\index{Vektorlayer!hinzufügen!Insel}

Mit dem Tool \toolbtntwo{mActionAddIsland}{Insel hinzufügen} können Sie ein
neues Polygons digitalisieren und einem zuvor selektierten Multipolygon
zuweisen. Das neue Inselpolygon muss ausserhalb des selektierten
Multipolygons digitalisiert werden.

\minisec{Objekte ausschneiden, kopieren und einfügen}
\index{Vektorlayer!Objekte ausschneiden}
\index{Vektorlayer!Objekte kopieren}
\index{Vektorlayer!Objekte einfügen}
\index{Editierfunktionen!Objekte ausschneiden}
\index{Editierfunktionen!Objekte kopieren}
\index{Editierfunktionen!Objekte einfügen}

Ausgewählte Objekte können ausgeschnitten, kopiert und an andere Ebenen im
aktuellen QGIS-Projekt übergeben (eingefügt) werden, wenn sich der Ziellayer
auch im Editiermodus befindet, indem Sie nach Auswahl des Ziellayers auf den
Knopf \toolbtntwo{mActionToggleEditing}{Bearbeitungsstatus umschalten} klicken.

Objekte können auch als Text an externe Applikationen übergeben werden: Dabei
wird ein Objekt im .csv Format mit ihrer Geometrie im OGC Well-Known Text
(WKT) Format erzeugt.

In dieser QGIS Version können Textobjekte außerhalb von QGIS nicht in eine
geladene Ebene eingefügt werden. Aber wann macht es Sinn, Objekte zum
kopieren, auszuschneiden und einzufügen? Ein Beispiel ist, wenn Sie parallel
an mehreren Layern arbeiten und Objekte zwischen den Layern hin- und
herkopieren möchten. Ein Szenario könnte sein, dass Sie einen neuen Layer
erstellen möchten, in dem aber nur einige Objekte aus einem bereits
existierenden Layer verwendet werden sollen, wie etwa 5 Seen aus der Karte
lakes.shp, die insgesamt aber tausende Seen enthält.

Wir nutzen diese Idee und machen daraus ein kleines Anwendungsbeispiel:

\begin{enumerate}
\item Laden Sie den Layer, von dem Sie einige Objekte kopieren wollen
(Quelle)
\item Laden oder erstellen Sie einen Layer, in den die kopierten Objekte
eingefügt werden sollen (Ziel)
\item Schalten Sie für beide Layer den Bearbeitungsstatus ein
\item Stellen Sie die Quelle aktiv, indem Sie es in der Legende anklicken
\item Benutzen Sie das \toolbtntwo{mActionSelect}{Wähle Objekt aus} Werkzeug
und wählen ein paar Objekte in der Quelle aus
\item Klicken Sie auf das Icon \toolbtntwo{mActionEditCopy}{Objekte kopieren}
\item Stellen Sie das ``Ziel'' aktiv, indem Sie es in der Legende anklicken
\item Klicken Sie auf das Icon \toolbtntwo{mActionEditPaste}{Objekte einfügen}
\item Beenden Sie den Bearbeitungsstatus für beide Layer und speichern Sie das
Ergebnis ab.
\end{enumerate}

Was passiert, wenn der Quell- und Ziellayer ein unterschiedliches Schema
enthält (Spaltennamen und -typen unterscheiden sich)? QGIS verwendet die
Einträge, die gleich sind und ignoriert den Rest. Wenn es Ihnen egal ist, ob
die Attribute korrekt übernommen werden, dann ist es egal, wie Sie die
Spaltennamen und -typen der Attributtabelle erstellen. Wenn auch die
Attributdaten korrekt übernommen werden sollen, dann stellen Sie sicher, dass
auch die Spaltennamen und -typen beider layer zueinander passen.

\begin{Tip}[h]\caption{\textsc{Deckungsgleichheit eingefügter Objekte}}
\qgistip{Wenn der Quell- und Ziellayer die gleiche Projektion nutzen, hat das
übergebene Objekt die identische Geometrie wie in dem Quelllayer. Wenn der
Quell- und Ziellayer eine unterschiedliche Projektion nutzen, kann das
übergebene Objekt eine andere Geometrie wie in dem Quelllayer besitzen. Der
Grund liegt in auftretenden Rundungsabweichungen bei der Konvertierung
zwischen Projektionen.
}
\end{Tip}

\minisec{Ausgewählte Objekte löschen}
\index{Vektorlayer!löschen!Objekte}

Wenn Sie ein ganzes Polygon löschen möchten, selektieren Sie es erst mit dem
\toolbtntwo{mActionSelect}{Wähle Objekt aus} Werkzeug. Sie können dabei auch
mehrere Objekte gleichzeitig auswählen. Wenn Sie die Objekte ausgewählt
haben, klicken Sie auf das Icon
\toolbtntwo{mActionDeleteSelected}{Ausgewähltes löschen}. Es gibt keine
Funktion, um das Löschen wieder rückgängig zu machen. Aber bedenken Sie, dass
die Änderungen erst dann wirksam werden, nachdem Sie den Bearbeitungsstatus
verändert und die Veränderungen gespeichert haben. Wenn Sie also einen Fehler
gemacht haben, können Sie einfach das Speichern abbrechen.

Das Werkzeug \toolbtntwo{mActionEditCut}{Ausgewählte Objekte ausschneiden}
kann auch benutzt werden, um Objekte zu löschen. Die Objekte werden gelöscht
aber zusätzlich noch im ``spatial clipboard' abgelegt. In diesem Fall könnte
man dann den letzten Schritt, falls ein Fehler unterlaufen ist, wieder
rückgängig machen, indem wir auf das Werkzeug
\toolbtntwo{mActionEditPaste}{Objekte einfügen} drücken. Ausschneiden,
kopieren und übergeben von Objekten funktioniert mit den gerade ausgewählten
Objekten und können nach Bedarf kombiniert verwendet werden.

\begin{Tip}[h]\caption{\textsc{Unterstützung zum Löschen von Objekten}}
\qgistip{Wenn Sie Shapes editieren wird das Löschen von Objekten nur
unterstützt, wenn QGIS zu einer GDAL Version 1.3.2 oder höher verlinkt ist.
Alle OS X, Windows und GNU/Linux Binärpakete auf der QGIS Downloadseite
wurden mit GDAL Version 1.3.2 oder höher erstellt.
}
\end{Tip}

\minisec{Fangtoleranz einstellen}
\index{Editierfunktionen!Fangtoleranz}

QGIS ermöglicht es, digitalisierte Stützpunkte an andere Stützpunkte
desselben Layers anzubinden. Dazu müssen Sie die Fangtoleranz im Menü
\mainmenuopt{Einstellungen} > \dropmenuopttwo{mActionOptions}{Optionen} >
\tab{Digitalisierung} entsprechend einstellen. Beachten Sie, dass der Wert
als Layereinheit interpretiert wird.

\minisec{Editierte Layer speichern}
\index{Editierfunktionen!Änderungen speichern}

Wenn sich ein Vektorlayer im Editiermodus befindet, werden alle Änderungen im
Speicher von QGIS abgelegt. Sie werden also nicht direkt auf den Datenträger
oder die Festplatte geschrieben. Wenn Sie den Editierstatus oder QGIS selbst
beenden, werden Sie gefragt, ob sie die aktuellen Änderungen speichern
möchten.

Wenn die Änderungen nicht gespeichert werden können (z.B.: weil die
Festplatte voll ist) bleiben diese 'im-memory' Status erhalten. Sie können somit
Veränderungen vornehmen und das Speichern erneut versuchen.

\subsubsection{Neuen Vektorlayer erstellen}\label{sec:create
shape}\index{Editierfunktionen!Neuen Vektorlayer erstellen}

Um einen neuen Vektorlayer zu erstellen, wählen Sie in der Menüleiste
\toolbtntwo{mActionNewVectorLayer}{Neuer Vektorlayer} aus dem Menü
\mainmenuopt{Layer}. Dadurch startet der Dialog \dialog{Neuer Vektorlayer}
(vgl. Abb. \ref{fig:newvectorlayer}). Wählen Sie hier den Typ des neuen
Layers(Punkt, Linie oder Polygon).

\begin{figure}[ht]
   \begin{center}
   \caption{Einen neuen Vektorlayer erstellen \nixcaption}\label{fig:newvectorlayer}\smallskip
   \includegraphics[clip=true, width=8cm]{editNewVector}
\end{center} 
\end{figure}

QGIS kann derzeit noch keine 2,5D Objekte erstellen (z.B. Objekte mit X,Y,Z
Koordinaten). Im Moment können nur Shapes erstellt werden. In zukünftigen
Versionen werden auch andere durch OGR oder PostgreSQL unterstützte
Datenformate erstellt werden können.

Das Erstellen eines GRASS Vektorlayers ist mit dem GRASS-Plugin möglich.
Weitere Information dazu finden Sie im Abschnitt
\ref{sec:creating_new_grass_vectors}.

Um die Erstellung eines neuen Vektorlayers abzuschließen, ergänzen Sie die
gewünschten Attributfelder, indem Sie auf den Knopf \button{Hinzufügen}
klicken und den Namen und Datentyp angeben. Es werden nur die Datentypen
\selectstring{Type}{real}, \selectstring{Type}{integer}, and
\selectstring{Type}{string} unterstützt. Wenn dies getan ist, bestätigen Sie mit
\button{Ok} und geben einen Namen für den Vektorlayer ein. Die Endung
\filename{.shp} wird automatisch ergänzt, der neue Layer wird automatisch
in die Kartenlegende eingefügt und Sie können den Layer entsprechend dem
Kapitel \ref{sec:edit_existing_layer} editieren.

\subsection{Query Builder}\label{sec:query_builder}
\index{Query Builder}

Der Query Builder ermöglicht es, eine Auswahl einer Attributtabelle zu
erstellen und die dazu gehörigen Geometrien im Kartenfenster anzuzeigen. Er
kann für alle OGR-unterstützten Formate, GRASS- und PostGIS-Ebenen verwendet
werden. Wenn Sie beispielsweise einen Layer \filename{Städte} haben, können
Sie alle Städte mit einer \usertext{Einwohnerzahl > 100000} auswählen und
anzeigen lassen. Abbildung \ref{fig:query_builder} zeigt eine
Beispielanwendung des Query Builders mit einem PostGIS-Layer.

\begin{figure}[ht]
  \begin{center}
    \caption{Query Builder \nixcaption}\label{fig:query_builder}\smallskip
    \includegraphics[clip=true, width=14cm]{queryBuilder}
  \end{center}  
\end{figure}

Der Query Builder\index{Query Builder} listet die vorhandenen Attributspalten
eines Vektorlayers in der linken oberen Box (Felder). Sie können einen
Ausschnitt der vorhanden Attributwerte im rechten oberen Feld (Werte)
anzeigen, indem Sie eine Attributspalte auswählen und auf den Knopf
\button{Stichprobe}\index{Query Builder!Beispielliste erstellen} klicken.
Dadurch werden die ersten 25 unterschiedlichen Werte der Attributspalte
angezeigt. Um eine vollständige Liste zu bekommen, klicken Sie auf den Knopf
\button{Alle}\index{Query Builder!Gesamtliste erstellen}. Um eine Attributspalte
in das untere Fenster (SQL where clause) zu kopieren, doppelklicken sie auf
den Namen in der Box (Felder)\index{Query Builder!Spalten hinzufügen}. Um eine
Abfrage zu erstellen, können Sie die verschiedenen Operatoren benutzen.

Um eine Abfrage zu testen, klicken Sie auf den Knopf
\button{Test}\index{Query Builder!Abfrage testen}. Dies erzeugt ein Fenster,
in dem die Anzahl der für diese Abfrage zutreffenden Objekte angezeigt wird.
Nach erfolgreichem Testen klicken Sie auf den Knopf \button{Ok}. Das
SQL-Kommando wird in der SQL-Spalte der Layerliste angezeigt werden.

\begin{Tip}\caption{\textsc{Ändern der Layer-Definition}}\index{Query
Builder!Layer-Definition ändern}
\qgistip{Sie können die Definition der Ebene ändern nachdem sie geladen ist,
indem sie die SQL-Abfrage anders starten. Dazu öffnen Sie den Dialog
\dialog{Layereigenschaften} durch Doppelklicken auf den Layernamen in der
Legende. Im Reiter \tab{Allgemein} befindet sich der Knopf \button{Query
Builder}. Weitere Informationen können Sie im Kapitel \ref{sec:vectorprops}
finden.}
\end{Tip}

\minisec{Aufruf des Query Builder für PostGIS-Layer}\index{Query
Builder!starten}

Der Query Builder funktioniert grundsätzlich mit allen von QGIS unterstützen
Vektorformaten. Im oberen Beispiel haben Sie den Query Builder dazu
verwendet, um eine Abfrage eines PostGIS-Layers durchzuführen. Dazu haben Sie
den \dialog{Layereigenschaften} Dialog des geladenen PostGIS-Layers geöffnet
und im Reiter \tab{Allgemein} auf den Knopf \button{Query Builder} geklickt. 

\minisec{Aufruf des Query Builder für OGR- und GRASS-Layer}

Dieses Vorgehen funktioniert momentan aber nur für PostGIS-Layer. Um den
Query Builder zu öffnen, und einen geladene OGR- oder GRASS-Layer abzufragen,
öffnen müssen Sie auf das Icon \toolbtntwo{mActionOpenTable}{Attributtabelle
öffnen} in der Werkzeugleiste klicken und dann im Dialogfenster auf den Knopf
\button{Erweitert} drücken. Dadurch wird ebenfalls der Query Builder
gestartet und ermöglicht Abfragen wie im obigen Abschnitt
\ref{sec:query_builder} für PostGIS beschrieben.


