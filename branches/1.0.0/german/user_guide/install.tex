% vim: set textwidth=78 autoindent:

\section{Installation aus dem Quellcode}\label{label_install}

% when the revision of a section has been finalized,
% comment out the following line:
% \updatedisclaimer

Die folgenden Kapitel stellen Informationen zur Verfügung, wie man die QGIS
Version \CURRENT aus dem Quellcode bauen und installieren kann. Dieses
Dokument entspricht in etwa der \LaTeX~ Konvertierung der Datei INSTALL.t2t
des QGIS Quellcodes vom 16. Dezember 2008.

Eine aktuelle Version ist im QGIS WIki verfügbar unter:
\htmladdnormallink{http://wiki.qgis.org/qgiswiki/BuildingFromSource}{http://wiki.qgis.org/qgiswiki/BuildingFromSource}

\subsection{Allgemeine Bemerkungen}

Seit der Version 0.8.1 verwendet QGIS cmake zum Kompilieren des Quellcodes
(\htmladdnormallink{http://www.cmake.org}{http://www.cmake.org}). Das
'configure' Skript sucht nach cmake und bietet Möglichkeiten, um QGIS zu
bauen.

Komplette Informationen befinden sich im Wiki unter:
   \htmladdnormallink{http://wiki.qgis.org/qgiswiki/Building\_with\_CMake}{http://wiki.qgis.org/qgiswiki/Building\_with\_CMake}

\subsection{Ein Überblick der notwendigen Dependencies}

\textbf{Benötigte Kompilier-Dependencies}:

\begin{itemize}
\item CMake $>$= 2.4.3
\item Flex, Bison
\end{itemize}

\textbf{Benötigte Laufzeit-Dependencies}:

\begin{itemize}
\item Qt $>$= 4.3.0
\item Proj $>$= 4.4.x
\item GEOS $>$= 2.2 (3.0 wird unterstützt, vielleicht geht auch 2.1.x)
\item Sqlite3 $>$= ? (wahrscheinlich 3.0.0)
\item GDAL/OGR $>$= 1.4.x
\end{itemize}

\textbf{Optionale Dependencies}:

\begin{itemize}
\item für das GRASS Plugin - GRASS $>$= 6.0.0
\item für den georeferencer - GSL $>$= ? (1.8)
\item für PostGIS Support und das SPIT Plugin - PostgreSQL $>$= 8.0.x
\item für GPS Plugin - expat $>$= ? (1.95 ist OK)
\item für Mapserver Export und PyQGIS - Python $>$= 2.3 (2.5+ bevorzugt)
\item für PyQGIS - SIP $>$= 4.5, PyQt $>$= muss zur Qt Version passen
\end{itemize}

\textbf{Empfohlene Laufzeit-Dependencies}:

\begin{itemize}
\item für GPS Plugin - gpsbabel
\end{itemize}

\section{Kompilieren unter MS Windows mit MSYS}\label{sec:install_windows}
\textbf{Note:} Für mehr Informationen besuchen Sie Marco Pasetti's Webseite:

\htmladdnormallink{http://www.webalice.it/marco.pasetti/qgis+grass/BuildFromSource.html}{http://www.webalice.it/marco.pasetti/qgis+grass/BuildFromSource.html}

Lesen Sie weiter für die vereinfachte Variante mit bereits kompilierten
Bibliotheken...

\subsection{MSYS:}
MSYS bietet eine UNIX-ähnliche Kompilierumgebung unter Windows. Wir haben ein
ZIP-File mit allen Dependencies erstellt:

\htmladdnormallink{http://download.osgeo.org/qgis/win32/msys.zip}{http://download.osgeo.org/qgis/win32/msys.zip}

entpacken Sie es unter C:$\backslash$msys

Wenn Sie die MSYS selbst erstellen wollen, finden Sie Informationen dazu
auch in diesem Dokument.

\subsection{Qt4.3}
Laden Sie die Qt4.3 Opensource Precompiled Edition exe herunter und
installieren Sie (inklusive Download und Installation von Mingw) von hier:

\htmladdnormallink{http://www.trolltech.com/developer/downloads/qt/windows}{http://www.trolltech.com/developer/downloads/qt/windows}

Wenn der Installer nach MinGW fragt, müssen Sie es nicht herunterladen und
installieren, verweisen Sie den Installer einfach auf c:$\backslash$msys$\backslash$mingw

Wenn die Qt Installation komplett ist:

Editieren Sie
C:$\backslash$Qt$\backslash$4.3.0$\backslash$bin$\backslash$qtvars.bat und
fügen folgende Zeilen hinzu:

\begin{verbatim}
set PATH=%PATH%;C:\msys\local\bin;c:\msys\local\lib 
set PATH=%PATH%;"C:\Program Files\Subversion\bin" 
\end{verbatim}

Ich schlage vor, Sie fügen auch
C:$\backslash$Qt$\backslash$4.3.0$\backslash$bin$\backslash$ zu ihren
Umgebungsvariablen hinzu in den Windows Preferences.

Wenn Sie debuggen möchten, müssen Sie die Debugversion von Qt kompilieren:
C:$\backslash$Qt$\backslash$4.3.0$\backslash$bin$\backslash$qtvars.bat compile\_debug

\textbf{Bemerkung:} Es gibt einb Problem beim Kompilieren der Debugversion
von Qt 4.3, das Skript endet mit folgender Aussage: "mingw32-make: *** No
rule to make target 'debug'.  Stop. Um die Debugversion zu kompilieren müssen
Sie aus den src Ordner gehen und folgendes Kommando ausführen.

\begin{verbatim}
c:\Qt\4.3.0 make 
\end{verbatim}

\subsection{Python: (optional)}

Lesen Sie dieses Kapitel, wenn Sie Python bindings in QGIS verwenden wollen.
Um die bindings zu kompilieren, müssen zuvor SIP und PyQT4 kompiliert werden. 

\subsubsection{Python herunterladen und installieren - mit MS Windows Installer}
(Es ist egal in welchen Ordner man es installiert)

\htmladdnormallink{http://python.org/download/}{http://python.org/download/}

\subsubsection{SIP und PyQt4 Quellen herunterladen}
\url{http://www.riverbankcomputing.com/software/sip/download} \\
\url{http://www.riverbankcomputing.com/software/pyqt/download}

Entpacken Sie jedes ZIP-File in einem temporären Ordner. Stellen Sie sicher,
dass die Version zur installierten Qt Version passen.

\subsubsection{SIP kompilieren}
\begin{verbatim}
c:\Qt\4.3.0\bin\qtvars.bat 
python configure.py -p win32-g++ 
make 
make install 
\end{verbatim}

\subsubsection{PyQt kompilieren}
\begin{verbatim}
c:\Qt\4.3.0\bin\qtvars.bat 
python configure.py 
make 
make install 
\end{verbatim}

\subsubsection{Abschließende Bemerkungen zu Python}

\textbf{Bemerkung:} Sie können die temporären Ordner nach erfolgreicher
Kompilierung löschen.

\subsection{Subversion:}

Um QGIS Quellen von einem Repository auszuchecken brauchen Sie den Subversion
Klienten. Dieser Installer sollte funktionieren:

\htmladdnormallink{http://subversion.tigris.org/files/documents/15/36797/svn-1.4.3-setup.exe}{http://subversion.tigris.org/files/documents/15/36797/svn-1.4.3-setup.exe}

\subsection{CMake:}
CMake ist das Buildsystem für Quantum GIS. Laden Sie es hier herunter:

\htmladdnormallink{http://www.cmake.org/files/v2.4/cmake-2.4.6-win32-x86.exe}{http://www.cmake.org/files/v2.4/cmake-2.4.6-win32-x86.exe}

\subsection{QGIS:}

Öffnen Sie ein cmd.exe Fenster ( Start -$>$ Run -$>$ cmd.exe ). Erstellen Sie
einen development Ordner und wechseln Sie dort hinein.

\begin{verbatim}
md c:\dev\cpp 
cd c:\dev\cpp 
\end{verbatim}

Checken Sie die Quellen von svn head aus:

\begin{verbatim}
svn co https://svn.osgeo.org/qgis/trunk/qgis 
\end{verbatim}

Für den svn 0.8 Branch
\begin{verbatim}
 svn co https://svn.osgeo.org/qgis/branches/Release-0_8_0 qgis0.8
\end{verbatim}

\subsection{Compiling:}
Nebenher können Sie die Information zum kompilieren mit CMake mit am Ende des
Dokuments lesen.

Öffnen Sie ein cmd.exe Fenster ( Start -$>$ Run -$>$ cmd.exe) und fügen Sie
die Pfade zum Kompiler und zur MSYS-Umgebung hinzu. 

\begin{verbatim}
c:\Qt\4.3.0\bin\qtvars.bat 
\end{verbatim}

Zur Vereinfachung fügen Sie
c:$\backslash$Qt$\backslash$4.3.0$\backslash$bin$\backslash$ zum Systempfad
in den Systemeinstellungen hinzu, damit Sie einfach qtvars.bat tippen können,
wenn Sie die cdm Konsole öffnen. Erstellen Sie den Buildordner und setzen Sie
es als aktuellen Ordner:

\begin{verbatim}
cd c:\dev\cpp\qgis 
md build 
cd build 
\end{verbatim}

\subsection{Konfiguration}
\begin{verbatim}
cmakesetup ..  
\end{verbatim}

\textbf{Bemerkung:} Sie müssen oben '..' ergänzen.

Klicken Sie den 'Configure' Button. Wenn gefragt wird, wählen Sie 'MinGW
Makefiles' als Generator.

Es gibt ein Problem mit MinGW Dateien unter Win2k. Verwenden Sie in diesem
Fall 'MSYS Makefiles'.

Alle Dependencies sollten automatisch eingebunden werden, wenn die Pfade
richtig gesetzt sind. Sie müssen nur den Installationsordner angeben
(CMAKE\_INSTALL\_PREFIX) und/oder 'Debug' setzen.

Für Kompatibilität mit NSIS packaging Skripten sollten Sie den Install Prefix
so belassen, wie er ist c:$\backslash$program files$\backslash$

Nach der Konfiguration klicken Sie auf 'Ok' und verlassen den Setup Dialog.

\subsection{Kompilieren und Installieren}
\begin{verbatim}
 make make install 
\end{verbatim}

\subsection{Starten von qgis.exe aus dem Installationsordner (CMAKE\_INSTALL\_PREFIX)}

Kopieren Sie alle .dlls in denselben Ordner, in den auch das qgis.exe
installiert wurde, falls dies noch nicht der Fall ist. Ansonsten wird sich
QGIS beim Start beschweren, dass Bibliotheken fehlen.

Am besten laden Sie dazu den QGIS current release installer von
\htmladdnormallink{http://qgis.org/uploadfiles/testbuilds/}{http://qgis.org/uploadfiles/testbuilds/}
herunter und installieren diesen. Nun kopieren Sie den Installationsordner
von C:$\backslash$Program Files$\backslash$Quantum GIS nach c:$\backslash$Program
Files$\backslash$qgis-1.0.0 (oder wie die aktuelle Version heisst. Der Name
sollte genau der QGIS Version entsprechen.) Danach können Sie die Release
Version mit dem Uninstaller aus dem Ordner c:$\backslash$Program Files
löschen. Prüfen Sie, ob alles gelöscht wurde.

Eine andere Möglichkeit besteht darin, qgis.exe zu starten, wenn der Pfad
c:$\backslash$msys$\backslash$local$\backslash$bin und c:$\backslash$men
sys$\backslash$local$\backslash$lib enthält, so dass die DLLs aus den Pfaden
verwendet werden.

\subsection{Ein Installationspaket erstellen (optional)}

Installieren Sie NSIS von (\htmladdnormallink{http://nsis.sourceforge.net/Main\_Page}{http://nsis.sourceforge.net/Main\_Page})

Erstellen Sie nun den win\_build Ordner im QGIS Quellordner. Lesen Sie den
README File darin und folgen Sie den Instruktionen. Danach klicken Sie mit
der rechten Maustaste auf qgis.nsi und wählen Sie die Option 'Compile NSIS Script'. 

\section{Kompilieren unter Mac OSX mit frameworks und cmake}\label{sec:install_macosx}

Hier sollen Build-Dependencies weitestgehend vermieden werden und stattdessen
frameworks verwendet werden, soweit möglich.

Ein paar Bemerkungen zum kompilieren unter Mac OS X 10.5 (\underline{Leopard}).

\subsection{XCODE installieren}

Installieren Sie das aktuelle xcode dmg von der Apple XDC Webseite.

\textbf{Bemerkung:} Es kann sein, dass sie ein paar Symlinks nach der
Installation des XCODE SDK erstellen müssen (besonders mit XCODE 2.5 unter
Tiger):

\begin{verbatim}
cd /Developer/SDKs/MacOSX10.4u.sdk/usr/
sudo mv local/ local_
sudo ln -s /usr/local/ local
\end{verbatim}

\subsection{Qt4 vom .dmg installieren}

Sie benötigen mindestens Qt4.3.0 und am besten die aktuelle Version.

\begin{verbatim}
ftp://ftp.trolltech.com/qt/source/qt-mac-opensource-4.3.2.dmg
\end{verbatim}

Debug-Bibliotheken finden Sie unter:

\begin{verbatim}
ftp://ftp.trolltech.com/qt/source/qt-mac-opensource-4.3.2-debug-libs.dmg
\end{verbatim}

An dieser Stelle wird nicht auf die Debug-Bibliotheken eingegangen.
Nach der Installation müssen Sie eine kleine Veränderungen vornehmen:

\begin{verbatim}
cd /usr/local/Qt4.3/mkspecs/ 
sudo rm default 
sudo ln -sf macx-g++ default
\end{verbatim}

\subsection{Install development frameworks for QGIS dependencies}
Download William Kyngesburye's excellent all in one framework that includes
proj, gdal, sqlite3 etc

\begin{verbatim}
http://www.kyngchaos.com/wiki/software:frameworks
\end{verbatim}

Once downloaded, open and install the frameworks.

William provides an additional installer package for Postgresql/PostGIS. Its
available here:

\begin{verbatim}
http://www.kyngchaos.com/wiki/software:postgres 
\end{verbatim}

There are some additional dependencies that at the time of writing are not
provided as frameworks so we will need to build these from source.

\subsubsection{Additional Dependencies : GSL}
Retrieve the Gnu Scientific Library from

\begin{verbatim}
curl -O ftp://ftp.gnu.org/gnu/gsl/gsl-1.8.tar.gz 
t\end{verbatim}

Then extract it and build it to a prefix of /usr/local:

\begin{verbatim}
tar xvfz gsl-1.8.tar.gz 
cd gsl-1.8 
./configure --prefix=/usr/local 
make
sudo make install
cd ..  
\end{verbatim}

\subsubsection{Additional Dependencies : Expat}
Get the expat sources:

\begin{verbatim}
http://sourceforge.net/project/showfiles.php?group_id=10127 
\end{verbatim}

\begin{verbatim}
tar xvfz expat-2.0.0.tar.gz 
cd expat-2.0.0 
./configure --prefix=/usr/local
make 
sudo make install 
cd ..  
\end{verbatim}

\subsubsection{Additional Dependencies : SIP}
Make sure you have the latest Python fom 

\begin{verbatim}
http://www.python.org/download/mac/
\end{verbatim}

\underline{Leopard note:} Leopard includes a usable Python 2.5.  Though you can install Python from python.org if preferred.

Retrieve the python bindings toolkit SIP from

\url{http://www.riverbankcomputing.com/software/sip/download}

Then extract and build it (this installs by default into the Python framework):

\begin{verbatim}
tar xvfz sip-<version number>.tar.gz 
cd sip-<version number>
python configure.py 
make 
sudo make install 
cd ..  
\end{verbatim}

\underline{Leopard notes}

If building on Leopard, using Leopard's bundled Python, SIP wants to install in the system path -- this is not a good idea.  Use this configure command instead of the basic configure above:

\begin{verbatim}
python configure.py -d /Library/Python/2.5/site-packages -b \
/usr/local/bin -e /usr/local/include -v /usr/local/share/sip
\end{verbatim}

\subsubsection{Additional Dependencies : PyQt}
If you encounter problems compiling PyQt using the instructions 
below you can also try adding python from your frameworks dir
explicitly to your path e.g.

\begin{verbatim}
export PATH=/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH$
\end{verbatim}

Retrieve the python bindings toolkit for Qt from

\begin{verbatim}
http://www.riverbankcomputing.com/software/pyqt/download
\end{verbatim}

Then extract and build it (this installs by default into the Python framework):

\begin{verbatim}
tar xvfz PyQt-mac<version number here>
cd PyQt-mac<version number here>
export QTDIR=/Developer/Applications/Qt
python configure.py 
yes 
make 
sudo make install 
cd ..  
\end{verbatim}

\underline{Leopard notes}

If building on Leopard, using Leopard's bundled Python, PyQt wants to install in the system path -- this is not a good idea.  Use this configure command instead of the basic configure above:

\begin{verbatim}
python configure.py -d /Library/Python/2.5/site-packages -b /usr/local/bin
\end{verbatim}

There may be a problem with undefined symbols in QtOpenGL on Leopard.  Edit QtOpenGL/makefile and add -undefined dynamic\_lookup to LFLAGS.

\subsubsection{Additional Dependencies : Bison}
\underline{Leopard note:} Leopard includes Bison 2.3, so this step can be skipped on Leopard.

The version of bison available by default on Mac OSX is too old so you need to
get a more recent one on your system. Download if from:

\begin{verbatim}
curl -O http://ftp.gnu.org/gnu/bison/bison-2.3.tar.gz 
\end{verbatim}

Now build and install it to a prefix of /usr/local :

\begin{verbatim}
tar xvfz bison-2.3.tar.gz 
cd bison-2.3 
./configure --prefix=/usr/local 
make
sudo make install 
cd ..  
\end{verbatim}

\subsection{Install CMAKE for OSX}
Get the latest release from here:

\begin{verbatim}
http://www.cmake.org/HTML/Download.html 
\end{verbatim}

At the time of writing the file I grabbed was:

\begin{verbatim}
curl -O http://www.cmake.org/files/v2.4/cmake-2.4.6-Darwin-universal.dmg
\end{verbatim}

Once downloaded open the dmg and run the installer

\subsection{Install subversion for OSX}
\underline{Leopard note:} Leopard includes SVN, so this step can be skipped on Leopard.

The \url{http://sourceforge.net/projects/macsvn/} project has a downloadable
build of svn. If you are a GUI inclined person you may want to grab their gui
client too. Get the command line client here:

\begin{verbatim}
curl -O http://ufpr.dl.sourceforge.net/sourceforge/macsvn/Subversion_1.4.2.zip 
\end{verbatim}

Once downloaded open the zip file and run the installer.

You also need to install BerkleyDB available from the same
\url{http://sourceforge.net/projects/macsvn/}. At the time of writing the file was here:

\begin{verbatim}
curl -O http://ufpr.dl.sourceforge.net/sourceforge/macsvn/Berkeley_DB_4.5.20.zip 
\end{verbatim}

Once again unzip this and run the installer therein. Lastly we need to ensure that the svn commandline executeable is in the path. Add the following line to the end of /etc/bashrc using 
sudo:

\begin{verbatim}
sudo vim /etc/bashrc 
\end{verbatim}

And add this line to the bottom before saving and quiting:

\begin{verbatim}
export PATH=/usr/local/bin:$PATH:/usr/local/pgsql/bin 
\end{verbatim}

/usr/local/bin needs to be first in the path so that the newer bison (that will be built from source further down) is found before the bison (which is very old) that is installed by MacOSX.

Now close and reopen your shell to get the updated vars.

\subsection{Check out QGIS from SVN}
Now we are going to check out the sources for QGIS. First we will create a
directory for working in:

\begin{verbatim}
mkdir -p ~/dev/cpp cd ~/dev/cpp 
\end{verbatim}

Now we check out the sources:

Trunk:

\begin{verbatim}
svn co https://svn.osgeo.org/qgis/trunk/qgis qgis 
\end{verbatim}

For svn 0.8 branch

\begin{verbatim}
svn co https://svn.osgeo.org/qgis/branches/Release-0_8_0 qgis0.8
\end{verbatim}

For svn 0.9 branch

\begin{verbatim}
svn co https://svn.qgis.org/qgis/branches/Release-0_9_0 qgis0.9
\end{verbatim}

The first time you check out QGIS sources you will probably get a message like
this:

\begin{verbatim}
 Error validating server certificate for 'https://svn.qgis.org:443':
 - The certificate is not issued by a trusted authority. Use the fingerprint to
   validate the certificate manually!  Certificate information:
 - Hostname: svn.qgis.org
 - Valid: from Apr  1 00:30:47 2006 GMT until Mar 21 00:30:47 2008 GMT
 - Issuer: Developer Team, Quantum GIS, Anchorage, Alaska, US
 - Fingerprint: 2f:cd:f1:5a:c7:64:da:2b:d1:34:a5:20:c6:15:67:28:33:ea:7a:9b
   (R)eject, accept (t)emporarily or accept (p)ermanently?  
\end{verbatim}

I suggest you press 'p' to accept the key permanently.

\subsection{Configure the build}
CMake supports out of source build so we will create a 'build' dir for the
build process. By convention I build my software into a dir called 'apps' in
my home directory. If you have the correct permissions you may want to build
straight into your /Applications folder. The instructions below assume you are
building into a pre-existing \$\{HOME\}/apps directory ...

\begin{verbatim}
cd qgis
mkdir build
cd build
cmake -D CMAKE_INSTALL_PREFIX=$HOME/apps/ -D CMAKE_BUILD_TYPE=Release ..
\end{verbatim}

\underline{Leopard note:} To find the custom install of SIP on Leopard, add ""-
D SIP\_BINARY\_PATH=/usr/local/bin/sip"" to the cmake command above,
before the .. at the end, ie:

\begin{verbatim}
cmake -D CMAKE_INSTALL_PREFIX=$HOME/apps/ -D CMAKE_BUILD_TYPE=Release -
D SIP_BINARY_PATH=/usr/local/bin/sip ..
\end{verbatim}

To use the application build of GRASS on OSX, you can optionally use the
following cmake invocation (minimum GRASS 6.3 required, substitute the GRASS
version as required):

\begin{verbatim}
cmake -D CMAKE_INSTALL_PREFIX=${HOME}/apps/ \
      -D GRASS_INCLUDE_DIR=/Applications/GRASS-6.3.app/Contents/MacOS/
      include \
      -D GRASS_PREFIX=/Applications/GRASS-6.3.app/Contents/MacOS \
      -D CMAKE_BUILD_TYPE=Release \
      ..
\end{verbatim}

Or, to use a Unix-style build of GRASS, use the following cmake invocation
(minimum GRASS version as stated in the Qgis requirements, substitute the GRASS
path and version as required):

\begin{verbatim}
cmake -D CMAKE_INSTALL_PREFIX=${HOME}/apps/ \
  -D GRASS_INCLUDE_DIR=/user/local/grass-6.3.0/include \
  -D GRASS_PREFIX=/user/local/grass-6.3.0 \
  -D CMAKE_BUILD_TYPE=Release \
  ..
\end{verbatim}

\subsection{Building}
Now we can start the build process:

\begin{verbatim}
make 
\end{verbatim}

If all built without errors you can then install it:

\begin{verbatim}
make install 
\end{verbatim}

\section{Building on GNU/Linux}\label{sec:install_linux}
\subsection{Building QGIS with Qt4.x}
\textbf{Requires:} Ubuntu Hardy / Debian derived distro

These notes are current for Ubuntu 7.10 - other versions and Debian derived 
distros may require slight variations in package names.

These notes are for if you want to build QGIS from source. One of the major
aims here is to show how this can be done using binary packages for \textbf{*all*}
dependencies - building only the core QGIS stuff from source. I prefer this
approach because it means we can leave the business of managing system packages
to apt and only concern ourselves with coding QGIS! 

This document assumes you have made a fresh install and have a 'clean' system.
These instructions should work fine if this is a system that has already been
in use for a while, you may need to just skip those steps which are irrelevant
to you.

\subsection{Prepare apt}
The packages qgis depends on to build are available in the "universe" component
of Ubuntu. This is not activated by default, so you need to activate it:

1. Edit your /etc/apt/sources.list file.  
2. Uncomment the all the lines starting with 'deb'

Also you will need to be running (K)Ubuntu 'edgy' or higher in order for 
all dependencies to be met.

Now update your local sources database:

\begin{verbatim}
sudo apt-get update 
\end{verbatim}

\subsection{Install Qt4}
\begin{verbatim}
sudo apt-get install libqt4-core libqt4-debug  \
libqt4-dev libqt4-gui libqt4-qt3support libqt4-sql lsb-qt4 qt4-designer \
qt4-dev-tools qt4-doc qt4-qtconfig uim-qt gcc libapt-pkg-perl resolvconf
\end{verbatim}

\textbf{A Special Note:} If you are following this set of instructions on
a system where you already have Qt3 development tools installed, there will
be a conflict between Qt3 tools and Qt4 tools. For example, qmake will
point to the Qt3 version not the Qt4. Ubuntu Qt4 and Qt3 packages are
designed to live alongside each other. This means that for example if you
have them both installed you will have three qmake exe's:

\begin{verbatim}
/usr/bin/qmake -> /etc/alternatives/qmake 
/usr/bin/qmake-qt3
/usr/bin/qmake-qt4 
\end{verbatim}

The same applies to all other Qt binaries. You will notice above that the
canonical 'qmake' is managed by apt alternatives, so before we start to
build QGIS, we need to make Qt4 the default. To return Qt3 to default later
you can use this same process.

You can use apt alternatives to correct this so that the Qt4 version of
applications is used in all cases:

\begin{verbatim}
sudo update-alternatives --config qmake
sudo update-alternatives --config uic 
sudo update-alternatives --config designer 
sudo update-alternatives --config assistant 
sudo update-alternatives --config qtconfig 
sudo update-alternatives --config moc 
sudo update-alternatives --config lupdate 
sudo update-alternatives --config lrelease 
sudo update-alternatives --config linguist 
\end{verbatim}

Use the simple command line dialog that appears after running each of the
above commands to select the Qt4 version of the relevant applications.

\subsection{Install additional software dependencies required by QGIS}
\begin{verbatim}
sudo apt-get install gdal-bin libgdal1-dev libgeos-dev proj \
libgdal-doc libhdf4g-dev libhdf4g-run python-dev \
libgsl0-dev g++ libjasper-dev libtiff4-dev subversion \
libsqlite3-dev sqlite3 ccache make libpq-dev flex bison cmake txt2tags \
python-qt4 python-qt4-dev python-sip4 sip4 python-sip4-dev
\end{verbatim}

\textbf{Note:} Debian users should use libgdal-dev above rather

\textbf{Note:} For python language bindings SIP $>$= 4.5 and PyQt4 $>$= 4.1 is required! Some stable GNU/Linux
distributions (e.g. Debian or SuSE) only provide SIP $<$ 4.5 and PyQt4 $<$ 4.1. To include support for python 
language bindings you may need to build and install those packages from source.

If you do not have cmake installed already:

\begin{verbatim}
sudo apt-get install cmake
\end{verbatim}

\subsection{GRASS Specific Steps}
\textbf{Note:} If you don't need to build with GRASS support,  you can
skip this section.

Now you can install grass from dapper:

\begin{verbatim}
sudo apt-get install grass libgrass-dev libgdal1-1.4.0-grass 
\end{verbatim}

/!$\backslash$ You may need to explicitly state your grass version e.g. libgdal1-1.3.2-grass

\subsection{Setup ccache (Optional)}
You should also setup ccache to speed up compile times:

\begin{verbatim}
cd /usr/local/bin 
sudo ln -s /usr/bin/ccache gcc 
sudo ln -s /usr/bin/ccache g++ 
\end{verbatim}

\subsection{Prepare your development environment}
As a convention I do all my development work in \$HOME/dev/$<$language$>$, so in
this case we will create a work environment for C++ development work like
this:

\begin{verbatim}
mkdir -p ${HOME}/dev/cpp 
cd ${HOME}/dev/cpp 
\end{verbatim}

This directory path will be assumed for all instructions that follow.

\subsection{Check out the QGIS Source Code}
There are two ways the source can be checked out. Use the anonymous method
if you do not have edit privaleges for the QGIS source repository, or use
  the developer checkout if you have permissions to commit source code
  changes.

1. Anonymous Checkout

\begin{verbatim}
cd ${HOME}/dev/cpp 
svn co https://svn.osgeo.org/qgis/trunk/qgis qgis
\end{verbatim}

2. Developer Checkout

\begin{verbatim}
cd ${HOME}/dev/cpp 
svn co --username <yourusername> https://svn.osgeo.org/qgis/trunk/qgis qgis 
\end{verbatim}

The first time you check out the source you will be prompted to accept the
qgis.org certificate. Press 'p' to accept it permanently:

\begin{verbatim}
Error validating server certificate for 'https://svn.qgis.org:443':
   - The certificate is not issued by a trusted authority. Use the
     fingerprint to validate the certificate manually!  Certificate
     information:
   - Hostname: svn.qgis.org
   - Valid: from Apr  1 00:30:47 2006 GMT until Mar 21 00:30:47 2008 GMT
   - Issuer: Developer Team, Quantum GIS, Anchorage, Alaska, US
   - Fingerprint:
     2f:cd:f1:5a:c7:64:da:2b:d1:34:a5:20:c6:15:67:28:33:ea:7a:9b (R)eject,
     accept (t)emporarily or accept (p)ermanently?  
\end{verbatim}

\subsection{Starting the compile}
\textbf{Note:} The next section describes howto build debian packages

I compile my development version of QGIS into my \~{}/apps directory to avoid
conflicts with Ubuntu packages that may be under /usr. This way for example
you can use the binary packages of QGIS on your system along side with your
development version. I suggest you do something similar:

\begin{verbatim}
mkdir -p ${HOME}/apps 
\end{verbatim}

Now we create a build directory and run ccmake:

\begin{verbatim}
cd qgis
mkdir build
cd build
ccmake ..
\end{verbatim}

When you run ccmake (note the .. is required!), a menu will appear where 
you can configure various aspects of the build. If you do not have root
access or do not want to overwrite existing QGIS installs (by your
packagemanager for example), set the CMAKE\_BUILD\_PREFIX to somewhere you
have write access to (I usually use /home/timlinux/apps). Now press
'c' to configure, 'e' to dismiss any error messages that may appear.
and 'g' to generate the make files. \textbf{Note:} that sometimes 'c' needs to 
be pressed several times before the 'g' option becomes available.
After the 'g' generation is complete, press 'q' to exit the ccmake 
interactive dialog.

Now on with the build:

\begin{verbatim}
make
make install
\end{verbatim}

It may take a little while to build depending on your platform.

\subsection{Building Debian packages}
Instead of creating a personal installation as in the previous step you can
also create debian package.  This is done from the qgis root directory, where
you'll find a debian directory.

First you need to install the debian packaging tools once:

\begin{verbatim}
apt-get install build-essential
\end{verbatim}

The QGIS packages will be created with:

\begin{verbatim}
dpkg-buildpackage -us -us -b
\end{verbatim}

\textbf{Note:} If \texttt{dpkg-buildpackage} complains about unmet build dependencies
you can install them using \texttt{apt-get} and re-run the command.

\textbf{Note:} If you have \texttt{libqgis1-dev} installed, you need to remove it first
using \texttt{dpkg -r libqgis1-dev}.  Otherwise \texttt{dpkg-buildpackage} will complain about a
build conflict.

The the packages are created in the parent directory (ie. one level up).
Install them using dpkg.  E.g.:

\begin{verbatim}
sudo dpkg -i \
	../qgis_1.0preview16_amd64.deb \
	../libqgis-gui1_1.0preview16_amd64.deb \
	../libqgis-core1_1.0preview16_amd64.deb \
	../qgis-plugin-grass_1.0preview16_amd64.deb \
	../python-qgis_1.0preview16_amd64.deb
\end{verbatim}

\subsection{Running QGIS}
Now you can try to run QGIS:

\begin{verbatim}
$HOME/apps/bin/qgis 
\end{verbatim}

If all has worked properly the QGIS application should start up and appear
on your screen.


\section{Creation of MSYS environment for compilation of Quantum GIS}
\subsection{Initial setup}
\subsubsection{MSYS}
This is the environment that supplies many utilities from UNIX world in Windows and is needed
by many dependencies to be able to compile.

Download from here:

\url{http://puzzle.dl.sourceforge.net/sourceforge/mingw/MSYS-1.0.11-2004.04.30-1.exe}

Install to \texttt{c:$\backslash$msys}

All stuff we're going to compile is going to get to this directory (resp. its subdirs).

\subsubsection{MinGW}
Download from here:

\url{http://puzzle.dl.sourceforge.net/sourceforge/mingw/MinGW-5.1.3.exe}

Install to \texttt{c:$\backslash$msys$\backslash$mingw}

It suffices to download and install only \texttt{g++} and \texttt{mingw-make} components.

\subsubsection{Flex and Bison}
Flex and Bison are tools for generation of parsers, they're needed for GRASS and also QGIS compilation.

Download the following packages:

\url{http://gnuwin32.sourceforge.net/downlinks/flex-bin-zip.php}

\url{http://gnuwin32.sourceforge.net/downlinks/bison-bin-zip.php}

\url{http://gnuwin32.sourceforge.net/downlinks/bison-dep-zip.php}

Unpack them all to \texttt{c:$\backslash$msys$\backslash$local}

\subsection{Installing dependencies}
\subsubsection{Getting ready}
Paul Kelly did a great job and prepared a package of precompiled libraries for GRASS.
The package currently includes:

\begin{itemize}
\item zlib-1.2.3
\item libpng-1.2.16-noconfig
\item xdr-4.0-mingw2
\item freetype-2.3.4
\item fftw-2.1.5
\item PDCurses-3.1
\item proj-4.5.0
\item gdal-1.4.1
\end{itemize}

It's available for download here:

\url{http://www.stjohnspoint.co.uk/grass/wingrass-extralibs.tar.gz}

Moreover he also left the notes how to compile it (for those interested):

\url{http://www.stjohnspoint.co.uk/grass/README.extralibs}

Unpack the whole package to \texttt{c:$\backslash$msys$\backslash$local}

\subsubsection{GDAL level one}
Since Quantum GIS needs GDAL with GRASS support, we need to compile GDAL
from source - Paul Kelly's package doesn't include GRASS support in GDAL.
The idea is following:

\begin{enumerate}
\item compile GDAL without GRASS
\item compile GRASS
\item compile GDAL with GRASS
\end{enumerate}

So, start with downloading GDAL sources:

\url{http://download.osgeo.org/gdal/gdal141.zip}

Unpack it to some directory, preferably \texttt{c:$\backslash$msys$\backslash$local$\backslash$src}.

Start MSYS console, go to gdal-1.4.1 directory and run the commands below.
You can put them all to a script, e.g. build-gdal.sh and run them at once.
The recipe is taken from Paul Kelly's instructions - basically they
just make sure that the library will be created as DLL and the utility
programs will be dynamically linked to it...

\begin{verbatim}
CFLAGS="-O2 -s" CXXFLAGS="-O2 -s" LDFLAGS=-s ./configure --without-libtool \
--prefix=/usr/local --enable-shared --disable-static --with-libz=/usr/local \
--with-png=/usr/local
make
make install
rm /usr/local/lib/libgdal.a
g++ -s -shared -o ./libgdal.dll -L/usr/local/lib -lz -lpng ./frmts/o/*.o ./gcore/*.o \
./port/*.o ./alg/*.o ./ogr/ogrsf_frmts/o/*.o ./ogr/ogrgeometryfactory.o \
./ogr/ogrpoint.o ./ogr/ogrcurve.o ./ogr/ogrlinestring.o ./ogr/ogrlinearring.o \
./ogr/ogrpolygon.o ./ogr/ogrutils.o ./ogr/ogrgeometry.o ./ogr/ogrgeometrycollection.o \
./ogr/ogrmultipolygon.o ./ogr/ogrsurface.o ./ogr/ogrmultipoint.o \
./ogr/ogrmultilinestring.o ./ogr/ogr_api.o ./ogr/ogrfeature.o ./ogr/ogrfeaturedefn.o \ 
./ogr/ogrfeaturequery.o ./ogr/ogrfeaturestyle.o ./ogr/ogrfielddefn.o \
./ogr/ogrspatialreference.o ./ogr/ogr_srsnode.o ./ogr/ogr_srs_proj4.o \
./ogr/ogr_fromepsg.o ./ogr/ogrct.o ./ogr/ogr_opt.o ./ogr/ogr_srs_esri.o \
./ogr/ogr_srs_pci.o ./ogr/ogr_srs_usgs.o ./ogr/ogr_srs_dict.o ./ogr/ogr_srs_panorama.o \
./ogr/swq.o ./ogr/ogr_srs_validate.o ./ogr/ogr_srs_xml.o ./ogr/ograssemblepolygon.o \
./ogr/ogr2gmlgeometry.o ./ogr/gml2ogrgeometry.o
install libgdal.dll /usr/local/lib
cd ogr
g++ -s ogrinfo.o -o ogrinfo.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s ogr2ogr.o -o ogr2ogr.exe -lgdal -L/usr/local/lib -lpng -lz -lgdal
g++ -s ogrtindex.o -o ogrtindex.exe -lgdal -L/usr/local/lib -lpng -lz -lgdal
install ogrinfo.exe ogr2ogr.exe ogrtindex.exe /usr/local/bin
cd ../apps
g++ -s gdalinfo.o -o gdalinfo.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdal_translate.o -o gdal_translate.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdaladdo.o -o gdaladdo.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdalwarp.o -o gdalwarp.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdal_contour.o -o gdal_contour.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdaltindex.o -o gdaltindex.exe -L/usr/local/lib -lpng -lz -lgdal
g++ -s gdal_rasterize.o -o gdal_rasterize.exe -L/usr/local/lib -lpng -lz -lgdal
install gdalinfo.exe gdal_translate.exe gdaladdo.exe gdalwarp.exe gdal_contour.exe \
gdaltindex.exe gdal_rasterize.exe /usr/local/bin

\end{verbatim}

Finally, manually edit \texttt{gdal-config} in \texttt{c:$\backslash$msys$\backslash$local$\backslash$bin} to replace the static library reference with -lgdal:

\begin{verbatim}
CONFIG_LIBS="-L/usr/local/lib -lpng -lz -lgdal"
\end{verbatim}
GDAL build procedure can be greatly simplified to use libtool with a libtool line patch:
configure gdal as below:
./configure --with-ngpython --with-xerces=/local/ --with-jasper=/local/ --with-grass=/local/grass-6.3.cvs/ --with-pg=/local/pgsql/bin/pg\_config.exe 

Then fix libtool with:
mv libtool libtool.orig
cat libtool.orig $|$ sed 's/max\_cmd\_len=8192/max\_cmd\_len=32768/g' $>$ libtool

Libtool on windows assumes a line length limit of 8192 for some reason and tries to page the linking and fails miserably. This is a work around.

Make and make install should be hassle free after this.

\subsubsection{GRASS}
Grab sources from CVS or use a weekly snapshot, see:

	\begin{quotation}
\htmladdnormallink{http://grass.itc.it/devel/cvs.php}{http://grass.itc.it/devel/cvs.php}
	\end{quotation}

In MSYS console go to the directory where you've unpacked or checked out sources
(e.g. \texttt{c:$\backslash$msys$\backslash$local$\backslash$src$\backslash$grass-6.3.cvs})

Run these commands:

\begin{verbatim}
export PATH="/usr/local/bin:/usr/local/lib:$PATH"
./configure --prefix=/usr/local --bindir=/usr/local --with-includes=/usr/local/include \
--with-libs=/usr/local/lib --with-cxx --without-jpeg --without-tiff --with-postgres=yes \
--with-postgres-includes=/local/pgsql/include --with-pgsql-libs=/local/pgsql/lib \
--with-opengl=windows --with-fftw --with-freetype \
--with-freetype-includes=/mingw/include/freetype2 \
--without-x --without-tcltk \
--enable-x11=no --enable-shared=yes --with-proj-share=/usr/local/share/proj
make
make install
\end{verbatim}

It should get installed to \texttt{c:$\backslash$msys$\backslash$local$\backslash$grass-6.3.cvs}

By the way, these pages might be useful:

\begin{itemize}
\item \htmladdnormallink{http://grass.gdf-hannover.de/wiki/WinGRASS\_Current\_Status}{http://grass.gdf-hannover.de/wiki/WinGRASS\_Current\_Status}
\item \htmladdnormallink{http://geni.ath.cx/grass.html}{http://geni.ath.cx/grass.html}
\end{itemize}

\subsubsection{GDAL level two}
At this stage, we'll use GDAL sources we've used before, only the compilation will be a bit different.

But first in order to be able to compile GDAL sources with current GRASS CVS, you need to patch them, here's what you need to change:

	\begin{quotation}
\htmladdnormallink{http://trac.osgeo.org/gdal/attachment/ticket/1587/plugin\_patch\_grass63.diff}{http://trac.osgeo.org/gdal/attachment/ticket/1587/plugin\_patch\_grass63.diff}
	\end{quotation}
(you can patch it by hand or use patch.exe in \texttt{c:$\backslash$msys$\backslash$bin})

Now in MSYS console go to the GDAL sources directory and run the same commands as in level one, only with these differences:

\begin{verbatim}
1) when running ./configure add this argument:
--with-grass=/usr/local/grass-6.3.cvs

2) when calling g++ on line 5 (which creates libgdal.dll), add these arguments: 
-L/usr/local/grass-6.3.cvs/lib -lgrass\_vect -lgrass\_dig2 -lgrass\_dgl -lgrass\_rtree \
-lgrass\_linkm -lgrass\_dbmiclient -lgrass\_dbmibase -lgrass\_I -lgrass\_gproj \ 
-lgrass\_vask -lgrass\_gmath -lgrass\_gis -lgrass\_datetime}
\end{verbatim}

Then again, edit \texttt{gdal-config} and change line with CONFIG\_LIBS

\begin{verbatim}
CONFIG_LIBS="-L/usr/local/lib -lpng -L/usr/local/grass-6.3.cvs/lib -lgrass_vect \
-lgrass_dig2 -lgrass_dgl -lgrass_rtree -lgrass_linkm -lgrass_dbmiclient \
-lgrass_dbmibase -lgrass_I -lgrass_gproj -lgrass_vask -lgrass_gmath -lgrass_gis \
-lgrass_datetime -lz -L/usr/local/lib -lgdal" 
\end{verbatim}

Now, GDAL should be able to work also with GRASS raster layers.

\subsubsection{GEOS}
Download the sources:

\url{http://geos.refractions.net/geos-2.2.3.tar.bz2}

Unpack to e.g. \texttt{c:$\backslash$msys$\backslash$local$\backslash$src}

To compile, I had to patch the sources: in file \texttt{source/headers/timeval.h} line 13.
Change it from:

\begin{verbatim}
#ifdef _WIN32
\end{verbatim}
to:

\begin{verbatim}
#if defined(_WIN32) && defined(_MSC_VER)
\end{verbatim}

Now, in MSYS console, go to the source directory and run:

\begin{verbatim}
./configure --prefix=/usr/local
make
make install
\end{verbatim}

\subsubsection{SQLITE}
You can use precompiled DLL, no need to compile from source:

Download this archive:


\url{http://www.sqlite.org/sqlitedll-3\_3\_17.zip}

and copy sqlite3.dll from it to \texttt{c:$\backslash$msys$\backslash$local$\backslash$lib}

Then download this archive:

\url{http://www.sqlite.org/sqlite-source-3\_3\_17.zip}

and copy sqlite3.h to \texttt{c:$\backslash$msys$\backslash$local$\backslash$include}

\subsubsection{GSL}
Download sources:

\url{ftp://ftp.gnu.org/gnu/gsl/gsl-1.9.tar.gz}

Unpack to \texttt{c:$\backslash$msys$\backslash$local$\backslash$src}

Run from MSYS console in the source directory:

\begin{verbatim}
./configure
make
make install
\end{verbatim}

\subsubsection{EXPAT}
Download sources:

\url{http://dfn.dl.sourceforge.net/sourceforge/expat/expat-2.0.0.tar.gz}

Unpack to \texttt{c:$\backslash$msys$\backslash$local$\backslash$src}

Run from MSYS console in the source directory:

\begin{verbatim}
./configure
make
make install
\end{verbatim}

\subsubsection{POSTGRES}
We're going to use precompiled binaries. Use the link below for download:

\begin{verbatim}
http://wwwmaster.postgresql.org/download/mirrors-ftp?file=\%2Fbinary\%2Fv8.2.4\%2Fwin32 \
\%2Fpostgresql-8.2.4-1-binaries-no-installer.zip
\end{verbatim}

copy contents of pgsql directory from the archive to \texttt{c:$\backslash$msys$\backslash$local}

\subsection{Cleanup}
We're done with preparation of MSYS environment. Now you can delete all stuff in \texttt{c:$\backslash$msys$\backslash$local$\backslash$src} - it takes quite a lot
of space and it's not necessary at all.


\section{Building with MS Visual Studio}
/!$\backslash$ This section describes a process where you build all dependencies yourself. See the section
after this for a simpler procedure where we have all the dependencies you need pre-packaged
and we focus just on getting Visual Studio Express set up and building QGIS.

\textbf{Note:} that this does not currently include GRASS or Python plugins.

\subsection{Setup Visual Studio}
This section describes the setup required to allow Visual Studio to be used to build QGIS. 

\subsubsection{Express Edition}
The free Express Edition lacks the platform SDK which contains headers and so on that are needed when building QGIS. The platform SDK can be installed as described here:


\url{http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/}

Once this is done, you will need to edit the $<$vsinstalldir$>$$\backslash$Common7$\backslash$Tools$\backslash$vsvars file as follows:

	\begin{quotation}
Add \texttt{\%PlatformSDKDir\%$\backslash$Include$\backslash$atl} and \texttt{\%PlatformSDKDir\%$\backslash$Include$\backslash$mfc} to the \texttt{@set INCLUDE} entry.
	\end{quotation}
This will add more headers to the system INCLUDE path. \textbf{Note:} that this will only work when you use the Visual Studio command prompt when building. Most of the dependencies will be built with this.
You will also need to perform the edits described here to remove the need for a library that Visual Studio Express lacks:

\url{http://www.codeproject.com/wtl/WTLExpress.asp}


\subsubsection{All Editions}
You will need stdint.h and unistd.h. unistd.h comes with GnuWin32 version of flex \& bison binaries (see later). stdint.h can be found here:

\url{http://www.azillionmonkeys.com/qed/pstdint.h}

Copy both of these to $<$vsinstalldir$>$$\backslash$VC$\backslash$include.

\subsection{Download/Install Dependencies}
This section describes the downloading and installation of the various QGIS dependencies.

\subsubsection{Flex and Bison}
Flex and Bison are tools for generation of parsers, they're needed for GRASS and also QGIS compilation.

Download the following packages and run the installers:

\url{http://gnuwin32.sourceforge.net/downlinks/flex.php} \\
\url{http://gnuwin32.sourceforge.net/downlinks/bison.php}

\subsubsection{To include  PostgreSQL support in Qt}
If you want to build Qt with PostgreSQL support you need to download
PostgreSQL, install it and create a library you can later link with Qt.

Download from .../binary/v8.2.5/win32/postgresql-8.2.5-1.zip from an
PostgreSQL.org Mirror and install.

PostgreSQL is currently build with MinGW and comes with headers and libraries
for MinGW.  The headers can be used with Visual C++ out of the box, but the library
is only shipped in DLL and archive (.a) form and therefore cannot be used with
Visual C++ directly.

To create a library copy following sed script to the file mkdef.sed in
PostgreSQL lib directory:

\begin{verbatim}
/Dump of file / {
	s/Dump of file \([^	 ]*\)$/LIBRARY \1/p
	a\
EXPORTS
}
/[ 	]*ordinal hint/,/^[	]*Summary/ {
 /^[ 	]\+[0-9]\+/ {
   s/^[ 	]\+[0-9]\+[ 	]\+[0-9A-Fa-f]\+[ 	]\+[0-9A-Fa-f]\+[ 	]\+\([^ 	=]\+\).*$/	\1/p
 }
}
\end{verbatim}

and process execute in the Visual Studio C++ command line (from Programs menu):

\begin{verbatim}
cd c:\Program Files\PostgreSQL\8.2\bin
dumpbin /exports ..\bin\libpq.dll | sed -nf ../lib/mkdef.sed >..\lib\libpq.def
cd ..\lib
lib /def:libpq.def /machine:x86
\end{verbatim}

You'll need an sed for that to work in your path (e.g. from cygwin or msys).

That's almost it. You only need to the include and lib path to INCLUDE and LIB in vcvars.bat respectively.

\subsubsection{Qt}
Build Qt following the instructions here:

\url{http://wiki.qgis.org/qgiswiki/Building\_QT\_4\_with\_Visual\_C\%2B\%2B\_2005}

\subsubsection{Proj.4}
Get proj.4 source from here:

\url{http://proj.maptools.org/}

Using the Visual Studio command prompt (ensures the environment is setup properly), run the following in the src directory:

\begin{verbatim}
nmake -f makefile.vc
\end{verbatim}

Install by running the following in the top level directory setting PROJ\_DIR as appropriate:

\begin{verbatim}
set PROJ_DIR=c:\lib\proj

mkdir %PROJ_DIR%\bin
mkdir %PROJ_DIR%\include
mkdir %PROJ_DIR%\lib

copy src\*.dll %PROJ_DIR%\bin
copy src\*.exe %PROJ_DIR%\bin
copy src\*.h %PROJ_DIR%\include
copy src\*.lib %PROJ_DIR%\lib 
\end{verbatim}

This can also be added to a batch file.

\subsubsection{GSL}
Get gsl source from here:

\url{http://david.geldreich.free.fr/downloads/gsl-1.9-windows-sources.zip}

Build using the gsl.sln file

\subsubsection{GEOS}
Get geos from svn (svn checkout \htmladdnormallink{http://svn.refractions.net/geos/trunk}{http://svn.refractions.net/geos/trunk} geos).
Edit geos$\backslash$source$\backslash$makefile.vc as follows:

Uncomment lines 333 and 334 to allow the copying of version.h.vc to version.h.

Uncomment lines 338 and 339.

Rename geos\_c.h.vc to geos\_c.h.in on lines 338 and 339 to allow the copying of geos\_c.h.in to geos\_c.h.

Using the Visual Studio command prompt (ensures the environment is setup properly), run the following in the top level directory:

\begin{verbatim}
nmake -f makefile.vc 
\end{verbatim}

Run the following in top level directory, setting GEOS\_DIR as appropriate:

\begin{verbatim}
set GEOS_DIR="c:\lib\geos"

mkdir %GEOS_DIR%\include
mkdir %GEOS_DIR%\lib
mkdir %GEOS_DIR%\bin

xcopy /S/Y source\headers\*.h %GEOS_DIR%\include
copy /Y capi\*.h %GEOS_DIR%\include
copy /Y source\*.lib %GEOS_DIR%\lib
copy /Y source\*.dll %GEOS_DIR%\bin
\end{verbatim}

This can also be added to a batch file.

\subsubsection{GDAL}
Get gdal from svn (svn checkout \htmladdnormallink{https://svn.osgeo.org/gdal/branches/1.4/gdal}{https://svn.osgeo.org/gdal/branches/1.4/gdal} gdal).

Edit nmake.opt to suit, it's pretty well commented.

Using the Visual Studio command prompt (ensures the environment is setup properly), run the following in the top level directory:

\begin{verbatim}
nmake -f makefile.vc 
\end{verbatim}

and

\begin{verbatim}
nmake -f makefile.vc devinstall 
\end{verbatim}

\subsubsection{PostGIS}
Get PostGIS and the Windows version of PostgreSQL from here:

\url{http://postgis.refractions.net/download/}

\textbf{Note:} the warning about not installing the version of PostGIS that comes with the PostgreSQL installer. Simply run the installers.

\subsubsection{Expat}
Get expat from here:

\url{http://sourceforge.net/project/showfiles.php?group\_id=10127}

You'll need expat-win32bin-2.0.1.exe.

Simply run the executable to install expat.

\subsubsection{CMake}
Get CMake from here:


\url{http://www.cmake.org/HTML/Download.html}

You'll need cmake-$<$version$>$-win32-x86.exe. Simply run this to install CMake.

\subsection{Building QGIS with CMAKE}
Get QGIS source from svn (svn co \htmladdnormallink{https://svn.osgeo.org/qgis/trunk/qgis}{https://svn.osgeo.org/qgis/trunk/qgis} qgis).

Create a 'Build' directory in the top level QGIS directory. This will be where all the build output will be generated.

Run Start--$>$All Programs--$>$CMake--$>$CMake. 

In the 'Where is the source code:' box, browse to the top level QGIS directory.

In the 'Where to build the binaries:' box, browse to the 'Build' directory you created in the top level QGIS directory.

Fill in the various *\_INCLUDE\_DIR and *\_LIBRARY entries in the 'Cache Values' list.

Click the Configure button. You will be prompted for the type of makefile that will be generated. Select Visual Studio 8 2005 and click OK.

All being well, configuration should complete without errors. If there are errors, it is usually due to an incorrect path to a header or library directory. Failed items will be shown in red in the list.

Once configuration completes without error, click OK to generate the solution and project files.

With Visual Studio 2005, open the qgis.sln file that will have been created in the Build directory you created earlier.

Build the ALL\_BUILD project. This will build all the QGIS binaries along with all the plugins.

 Install QGIS by building the INSTALL project. By default this will install to c:$\backslash$Program Files$\backslash$qgis$<$version$>$ (this can be changed by changing the CMAKE\_INSTALL\_PREFIX variable in CMake). 

 You will also either need to add all the dependency dlls to the QGIS install directory or add their respective directories to your PATH.

\section{Building under Windows using MSVC Express}
\textbf{Note:}: Building under MSVC is still a work in progress. In particular the following dont work yet: python, grass, postgis connections.

/!$\backslash$ This section of the document is in draft form and is not ready to be used yet.

Tim Sutton, 2007

\subsection{System preparation}
I started with a clean XP install with Service Pack 2 and all patches applied.
I have already compiled all the dependencies you need for gdal, expat etc,
so this tutorial wont cover compiling those from source too. Since compiling 
these dependencies was a somewhat painful task I hope my precompiled libs 
will be adequate. If not I suggest you consult the individual projects for
specific build documentation and support. Lets go over the process in a nutshell 
before we begin:

 * Install XP (I used a Parallels virtual machine)
 * Install the premade libraries archive I have made for you
 * Install Visual Studio Express 2005 sp1
 * Install the Microsoft Platform SDK
 * Install command line subversion client
 * Install library dependencies bundle
 * Install Qt 4.3.2
 * Check out QGIS sources
 * Compile QGIS
 * Create setup.exe installer for QGIS

\subsection{Install the libraries archive}
Half of the point of this section of the MSVC setup procedure is to make 
things as simple as possible for you. To that end I have prepared an
archive that includes all dependencies needed to build QGIS except Qt 
(which we will build further down). Fetch the archive from:

\begin{verbatim}
http://qgis.org/uploadfiles/msvc/qgis_msvc_deps_except_qt4.zip
\end{verbatim}

Create the following directory structure:

\begin{verbatim}
c:\dev\cpp\
\end{verbatim}

And then extract the libraries archive into a subdirectory of the above
directory so that you end up with:

\begin{verbatim}
c:\dev\cpp\qgislibs-release
\end{verbatim}

\textbf{Note:} that you are not obliged to use this directory layout, but you 
should adjust any instructions that follow if you plan to do things 
differently.

\subsection{Install Visual Studio Express 2005}
First thing we need to get is MSVC Express from here:

\htmladdnormallink{http://msdn2.microsoft.com/en-us/express/aa975050.aspx}{http://msdn2.microsoft.com/en-us/express/aa975050.aspx}

The page is really confusing so dont feel bad if you cant actually find the 
download at first! There are six coloured blocks on the page for the various  
studio family members (vb / c\# / j\# etc). Simply choose your language under 
the 'select your language' combo under the yellow C++ block, and your download 
will begin. Under internet explorer I had to disable popup blocking for the 
download to be able to commence.

Once the setup commences you will be prompted with various options. Here is what 
I chose :

 * Send useage information to Microsoft   (No)
 * Install options:
   * Graphical IDE                        (Yes)
   * Microsoft MSDN Express Edition       (No)
   * Microsoft SQL Server Express Edition (No)
 * Install to folder: C:$\backslash$Program Files$\backslash$Microsoft Visual Studio 8$\backslash$   (default)

It will need to download around 90mb of installation files and reports 
that the install will consume 554mb of disk space.

\subsection{Install Microsoft Platform SDK2}
Go to this page:

\htmladdnormallink{http://msdn2.microsoft.com/en-us/express/aa700755.aspx}{http://msdn2.microsoft.com/en-us/express/aa700755.aspx}

Start by using the link provided on the above page to download and install the
platform SDK2.

The actual SDK download page is once again a bit confusing since the links for 
downloading are hidden amongst a bunch of other links. Basically look for these 
three links with their associated 'Download' buttons and choose the correct 
link for your platform:

\begin{verbatim}
PSDK-amd64.exe  1.2 MB  Download 
PSDK-ia64.exe   1.3 MB  Download 
PSDK-x86.exe    1.2 MB  Download
\end{verbatim}

When you install make sure to choose 'custom install'. These instructions 
assume you are installing into the default path of:

\begin{verbatim}
C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\
\end{verbatim}

We will go for the minimal install that will give us a working environment, 
so on the custom installation screen I made the following choices:

\begin{verbatim}
Configuration Options
  + Register Environmental Variables            (Yes)
Microsoft Windows Core SDK
  + Tools                                       (Yes)
    + Tools (AMD 64 Bit)                        (No unless this applies)
    + Tools (Intel 64 Bit)                      (No unless this applies)
  + Build Environment
    + Build Environment (AMD 64 Bit)            (No unless this applies)
    + Build Environment (Intel 64 Bit)          (No unless this applies)
    + Build Environment (x86 32 Bit)            (Yes)
  + Documentation                               (No)
  + Redistributable Components                  (Yes)
  + Sample Code                                 (No)
  + Source Code                                 (No)
    + AMD 64 Source                             (No)
    + Intel 64 Source                           (No)
Microsoft Web Workshop                          (Yes) (needed for shlwapi.h)
  + Build Environment                           (Yes)
  + Documentation                               (No)
  + Sample Code                                 (No)
  + Tools                                       (No)
Microsoft Internet Information Server (IIS) SDK (No)
Microsoft Data Access Services (MDAC) SDK       (Yes) (needed by GDAL for odbc)
  + Tools
    + Tools (AMD 64 Bit)                        (No)
    + Tools (AMD 64 Bit)                        (No)
    + Tools (x86 32 Bit)                        (Yes)
  + Build Environment
    + Tools (AMD 64 Bit)                        (No)
    + Tools (AMD 64 Bit)                        (No)
    + Tools (x86 32 Bit)                        (Yes)
  + Documentation                               (No)
  + Sample Code                                 (No)
Microsodt Installer SDK                         (No)
Microsoft Table PC SDK                          (No)
Microsoft Windows Management Instrumentation    (No)
Microsoft DirectShow SDK                        (No)
Microsoft Media Services SDK                    (No)
Debuggin Tools for Windows                      (Yes)
\end{verbatim}

\textbf{Note:} that you can always come back later to add extra bits if you like.

\textbf{Note:} that installing the SDK requires validation with the 
Microsoft Genuine Advantage application. Some people have a philosophical 
objection to installing this software on their computers. If you are one 
of them you should probably consider using the MINGW build instructions 
described elsewhere in this document.

The SDK installs a directory called

\begin{verbatim}
C:\Office10
\end{verbatim}

Which you can safely remove.

After the SDK is installed, follow the remaining notes on the page link 
above to get your MSVC Express environment configured correctly. For your 
convenience, these are summarised again below, and I have added a couple 
more paths that I discovered were needed:

1) open Visual Studio Express IDE

2) Tools -$>$ Options -$>$ Projects and Solutions -$>$ VC++ Directories

3) Add:

\begin{verbatim}
Executable files: 
  C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Bin

Include files: 
  C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Include
  C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Include\atl
  C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Include\mfc
Library files: C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Lib
\end{verbatim}

4) Close MSVC Express IDE

5) Open the following file with notepad:

\begin{verbatim}
C:\Program Files\Microsoft Visual Studio 8\VC\VCProjectDefaults\corewin_express.vsprops
\end{verbatim}

and change the property:

\begin{verbatim}
AdditionalDependencies="kernel32.lib"
\end{verbatim}

To read:

\begin{verbatim}
AdditionalDependencies="kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib 
                        advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib"
\end{verbatim}

The notes go on to show how to build a mswin32 application which you can try if you like - 
I'm not going to recover that here.

\subsection{Edit your vsvars}
Backup your vsvars32.bat file in 

\begin{verbatim}
C:\Program Files\Microsoft Visual Studio 8\Common7\Tools
\end{verbatim}

and replace it with this one:

\begin{verbatim}
@SET VSINSTALLDIR=C:\Program Files\Microsoft Visual Studio 8
@SET VCINSTALLDIR=C:\Program Files\Microsoft Visual Studio 8\VC
@SET FrameworkDir=C:\WINDOWS\Microsoft.NET\Framework
@SET FrameworkVersion=v2.0.50727
@SET FrameworkSDKDir=C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0
@if "%VSINSTALLDIR%"=="" goto error_no_VSINSTALLDIR
@if "%VCINSTALLDIR%"=="" goto error_no_VCINSTALLDIR

@echo Setting environment for using Microsoft Visual Studio 2005 x86 tools.

@rem
@rem Root of Visual Studio IDE installed files.
@rem
@set DevEnvDir=C:\Program Files\Microsoft Visual Studio 8\Common7\IDE

@set PATH=C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;C:\Program \
Files\Microsoft Visual Studio 8\VC\BIN;C:\Program Files\Microsoft Visual Studio 8\ \
Common7\Tools;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\bin; \
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727;C:\Program Files\Microsoft Visual \
Studio 8\VC\VCPackages;%PATH%
@rem added by Tim
@set PATH=C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Bin;%PATH%
@set INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\INCLUDE; \
%INCLUDE%
@rem added by Tim
@set INCLUDE=C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\ \
Include;%INCLUDE%
@set INCLUDE=C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\ \
Include\mfc;%INCLUDE%
@set INCLUDE=%INCLUDE%;C:\dev\cpp\qgislibs-release\include\postgresql
@set LIB=C:\Program Files\Microsoft Visual Studio 8\ \
VC\LIB;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\lib;%LIB%
@rem added by Tim
@set LIB=C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Lib;%LIB%
@set LIB=%LIB%;C:\dev\cpp\qgislibs-release\lib
@set LIBPATH=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727

@goto end

:error_no_VSINSTALLDIR
@echo ERROR: VSINSTALLDIR variable is not set. 
@goto end

:error_no_VCINSTALLDIR
@echo ERROR: VCINSTALLDIR variable is not set. 
@goto end

:end

\end{verbatim}

\subsection{Environment Variables}
Right click on 'My computer' then select the 'Advanced' tab. Click environment variables and 
create or augment the following '''System''' variables (if they dont already exist):

\begin{verbatim}
Variable Name:     Value:
--------------------------------------------------------------------------
EDITOR             vim
INCLUDE            C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2 \
\Include\.
LIB                C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2 \
\Lib\.
LIB_DIR            C:\dev\cpp\qgislibs-release
PATH               C:\Program Files\CMake 2.4\bin;
                   %SystemRoot%\system32;
                   %SystemRoot%;
                   %SystemRoot%\System32\Wbem;
                   C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2 \
                   \Bin\.;
                   C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\  \
                   \Bin\WinNT\;
                   C:\Program Files\svn\bin;C:\Program Files\Microsoft Visual Studio 8 \
                   \VC\bin;
                   C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;
                   "c:\Program Files\Microsoft Visual Studio 8\Common7\Tools";
                   c:\Qt\4.3.2\bin;
                   "C:\Program Files\PuTTY"
QTDIR              c:\Qt\4.3.2
SVN_SSH            "C:\\Program Files\\PuTTY\\plink.exe"
\end{verbatim}

\subsection{Building Qt4.3.2}
You need a minimum of Qt 4.3.2 here since this is the first version to officially 
support building the open source version of Qt for windows under MSVC.

Download Qt 4.x.x source for windows from

\begin{verbatim}
http:\\www.trolltech.com
\end{verbatim}

Unpack the source to 

\begin{verbatim}
c:\Qt\4.x.x\
\end{verbatim}

\subsubsection{Compile Qt}
Open the Visual Studio C++ command line and cd to c:$\backslash$Qt$\backslash$4.x.x where you
extracted the source and enter:

\begin{verbatim}
configure -platform win32-msvc2005
nmake
nmake install
\end{verbatim}

Add -qt-sql-odbc -qt-sql-psql to the configure line if your want odbc and
PostgreSQL support build into Qt.

\textbf{Note:} For me in some cases I got a build error on qscreenshot.pro. If you
are only interested in having the libraries needed for building Qt apps, you 
can probably ignore that. Just check in c:$\backslash$Qt$\backslash$4.3.2$\backslash$bin to check all dlls and 
helper apps (assistant etc) have been made.

\subsubsection{Configure Visual C++ to use Qt}
After building configure the Visual Studio Express IDE to use Qt:

1) open Visual Studio Express IDE

2) Tools -$>$ Options -$>$ Projects and Solutions -$>$ VC++ Directories

3) Add:

\begin{verbatim}
Executable files: 
  $(QTDIR)\bin

Include files: 
  $(QTDIR)\include
  $(QTDIR)\include\Qt
  $(QTDIR)\include\QtCore
  $(QTDIR)\include\QtGui
  $(QTDIR)\include\QtNetwork
  $(QTDIR)\include\QtSvg
  $(QTDIR)\include\QtXml
  $(QTDIR)\include\Qt3Support
  $(LIB_DIR)\include   (needed during qgis compile to find stdint.h and unistd.h)

Library files: 
  $(QTDIR)\lib

Source Files:
  $(QTDIR)\src
\end{verbatim}

Hint:  You can also add

\begin{verbatim}
QString = t=<d->data, su>, size=<d->size, i>
\end{verbatim}

to AutoExp.DAT in C:$\backslash$Program Files$\backslash$Microsoft Visual Studio 8$\backslash$Common7$\backslash$Packages$\backslash$Debugger before 

\begin{verbatim}
[Visualizer]
\end{verbatim}

That way the Debugger will show the contents of QString when you point at or
watch a variable in the debugger.  There are probably much more additions -
feel free to add some - I just needed QString and took the first hit in google
I could find.

\subsection{Install Python}
Download \htmladdnormallink{http://python.org/ftp/python/2.5.1/python-2.5.1.msi}{http://python.org/ftp/python/2.5.1/python-2.5.1.msi} and install it.

\subsection{Install SIP}
Download \htmladdnormallink{http://www.riverbankcomputing.com/Downloads/sip4/sip-4.7.1.zip}{http://www.riverbankcomputing.com/Downloads/sip4/sip-4.7.1.zip} and extract it 
into your c:$\backslash$dev$\backslash$cpp directory.
From a Visual C++ command line cd to the directory where you extract SIP and run:

\begin{verbatim}
c:\python25\python configure.py -p win32-msvc2005
nmake
nmake install
\end{verbatim}

\subsection{Install PyQt4}
Download \htmladdnormallink{http://www.riverbankcomputing.com/Downloads/PyQt4/GPL/PyQt-win-gpl-4.3.1.zip}{http://www.riverbankcomputing.com/Downloads/PyQt4/GPL/PyQt-win-gpl-4.3.1.zip} and extract it 
into your c:$\backslash$dev$\backslash$cpp directory.
From a Visual C++ command line cd to the directory where you extracted PyQt4 and run:

\begin{verbatim}
c:\python25\python configure.py -p win32-msvc2005
nmake
nmake install
\end{verbatim}

\subsection{Install CMake}
Download and install cmake 2.4.7 or better, making sure to enable the option: \texttt{Update path for all users}

\subsection{Install Subversion}
You '''must''' install the command line version if you want the CMake svn scripts to work.
Its a bit tricky to find the correct version on the subversion download site as they have 
som misleadingly named similar downloads. Easiest is to just get this file:

\htmladdnormallink{http://subversion.tigris.org/downloads/1.4.5-win32/apache-2.2/svn-win32-1.4.5.zip}{http://subversion.tigris.org/downloads/1.4.5-win32/apache-2.2/svn-win32-1.4.5.zip}

Extract the zip file to
\begin{verbatim}
C:\Program Files\svn
\end{verbatim}

And then add

\begin{verbatim}
C:\Program Files\svn\bin
\end{verbatim}

To your path.

\subsection{Initial SVN Check out}
Open a cmd.exe window and do:

\begin{verbatim}
cd \
cd dev
cd cpp
svn co https://svn.osgeo.org/qgis/trunk/qgis 
\end{verbatim}

At this point you will probably get a message like this:

\begin{verbatim}
C:\dev\cpp>svn co https://svn.osgeo.org/qgis/trunk/qgis
Error validating server certificate for 'https://svn.qgis.org:443':
 - The certificate is not issued by a trusted authority. Use the
   fingerprint to validate the certificate manually!
Certificate information:
 - Hostname: svn.qgis.org
 - Valid: from Sat, 01 Apr 2006 03:30:47 GMT until Fri, 21 Mar 2008 03:30:47 GMT
 - Issuer: Developer Team, Quantum GIS, Anchorage, Alaska, US
 - Fingerprint: 2f:cd:f1:5a:c7:64:da:2b:d1:34:a5:20:c6:15:67:28:33:ea:7a:9b
(R)eject, accept (t)emporarily or accept (p)ermanently?
\end{verbatim}

Press 'p' to accept and the svn checkout will commence.

\subsection{Create Makefiles using cmakesetup.exe}
I wont be giving a detailed description of the build process, because 
the process is explained in the first section (where you manually build 
all dependencies) of the windows build notes in this document. Just skip 
past the parts where you need to build GDAL etc, since this simplified 
install process does all the dependency provisioning for you.

\begin{verbatim}
cd qgis
mkdir build
cd build
cmakesetup ..
\end{verbatim}

Cmakesetup should find all dependencies for you automatically (it uses the 
LIB\_DIR environment to find them all in c:$\backslash$dev$\backslash$cpp$\backslash$qgislibs-release). 
Press configure again after the cmakesetup gui appears and when all the red 
fields are gone, and you have made any personalisations to the setup, press 
ok to close the cmake gui.

Now open Visual Studio Express and do: \texttt{File -$>$ Open -$>$ Project / Solution}

Now open the cmake generated QGIS solution which should be in :

\begin{verbatim}
c:\dev\cpp\qgis\build\qgisX.X.X.sln
\end{verbatim}

Where X.X.X represents the current version number of QGIS. Currently I 
have only made release built dependencies for QGIS (debug versions will follow 
in future), so you need to be sure to select 'Release' from the solution 
configurations toolbar. Next right click on ALL\_BUILD in the solution browser, and then choose build. Once the build completes right click on INSTALL in the solution browser and 
choose build. This will by default install qgis into c:$\backslash$program files$\backslash$qgisX.X.X.

\subsection{Running and packaging}
To run QGIS you need to at the minimum copy the dlls from c:$\backslash$dev$\backslash$cpp$\backslash$qgislibs-release$\backslash$bin 
into the c:$\backslash$program files$\backslash$qgisX.X.X directory.


